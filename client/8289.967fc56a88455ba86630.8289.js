"use strict";(this.webpackChunk=this.webpackChunk||[]).push([[8289],{8289:(t,e,n)=>{function o(t){if("string"!=typeof t||!t)throw new Error("expected a non-empty string, got: "+t)}function r(t){if("number"!=typeof t)throw new Error("expected a number, got: "+t)}n.d(e,{Z:()=>nt});const s=1,i=1,a="emoji",c="keyvalue",u="favorites",d="tokens",f="tokens",h="unicode",l="count",w="group",y="order",m="group-order",p="eTag",g="url",b="skinTone",_="readonly",k="readwrite",j="skinUnicodes",v="skinUnicodes";function S(t){return function(t,e){const n=new Set,o=[];for(const r of t){const t=e(r);n.has(t)||(n.add(t),o.push(r))}return o}(t,(t=>t.unicode))}const C={},E={},B={};function A(t,e,n){n.onerror=()=>e(n.error),n.onblocked=()=>e(new Error("IDB blocked")),n.onsuccess=()=>t(n.result)}async function D(t){const e=await new Promise(((e,n)=>{const o=indexedDB.open(t,s);C[t]=o,o.onupgradeneeded=t=>{t.oldVersion<i&&function(t){function e(e,n,o){const r=n?t.createObjectStore(e,{keyPath:n}):t.createObjectStore(e);if(o)for(const[t,[s,i]]of Object.entries(o))r.createIndex(t,s,{multiEntry:i});return r}e(c),e(a,h,{[f]:[d,!0],[m]:[[w,y]],[j]:[v,!0]}),e(u,void 0,{[l]:[""]})}(o.result)},A(e,n,o)}));return e.onclose=()=>x(t),e}function L(t,e,n,o){return new Promise(((r,s)=>{const i=t.transaction(e,n,{durability:"relaxed"}),a="string"==typeof e?i.objectStore(e):e.map((t=>i.objectStore(t)));let c;o(a,i,(t=>{c=t})),i.oncomplete=()=>r(c),i.onerror=()=>s(i.error)}))}function x(t){const e=C[t],n=e&&e.result;if(n){n.close();const e=B[t];if(e)for(const t of e)t()}delete C[t],delete E[t],delete B[t]}const U=new Set([":D","XD",":'D","O:)",":X",":P",";P","XP",":L",":Z",":j","8D","XO","8)",":B",":O",":S",":'o","Dx","X(","D:",":C",">0)",":3","</3","<3","\\M/",":E","8#"]);function T(t){return t.split(/[\s_]+/).map((t=>!t.match(/\w/)||U.has(t)?t.toLowerCase():t.replace(/[)(:,]/g,"").replace(/’/g,"'").toLowerCase())).filter(Boolean)}const N=2;function P(t){return t.filter(Boolean).map((t=>t.toLowerCase())).filter((t=>t.length>=N))}function O(t,e,n,o){t[e](n).onsuccess=t=>o&&o(t.target.result)}function I(t,e,n){O(t,"get",e,n)}function M(t,e,n){O(t,"getAll",e,n)}function K(t){t.commit&&t.commit()}function V(t,e){const n=function(t,e){let n=t[0];for(let o=1;o<t.length;o++){const r=t[o];e(n)>e(r)&&(n=r)}return n}(t,(t=>t.length)),o=[];for(const r of n)t.some((t=>-1===t.findIndex((t=>e(t)===e(r)))))||o.push(r);return o}async function X(t,e,n,o){try{const r=function(t){return t.map((({annotation:t,emoticon:e,group:n,order:o,shortcodes:r,skins:s,tags:i,emoji:a,version:c})=>{const u=[...new Set(P([...(r||[]).map(T).flat(),...i.map(T).flat(),...T(t),e]))].sort(),d={annotation:t,group:n,order:o,tags:i,tokens:u,unicode:a,version:c};if(e&&(d.emoticon=e),r&&(d.shortcodes=r),s){d.skinTones=[],d.skinUnicodes=[],d.skinVersions=[];for(const{tone:t,emoji:e,version:n}of s)d.skinTones.push(t),d.skinUnicodes.push(e),d.skinVersions.push(n)}return d}))}(e);await L(t,[a,c],k,(([t,e],s)=>{let i,a,c=0;function u(){2==++c&&function(){if(i===o&&a===n)return;t.clear();for(const e of r)t.put(e);e.put(o,p),e.put(n,g),K(s)}()}I(e,p,(t=>{i=t,u()})),I(e,g,(t=>{a=t,u()}))}))}finally{}}async function z(t,e){const n=P(T(e));return n.length?L(t,a,_,((t,e,o)=>{const r=[],s=()=>{const t=V(r,(t=>t.unicode));o(t.sort(((t,e)=>t.order<e.order?-1:1)))};for(let i=0;i<n.length;i++){const e=n[i],o=i===n.length-1?IDBKeyRange.bound(e,e+"￿",!1,!0):IDBKeyRange.only(e);M(t.index(f),o,(t=>{r.push(t),r.length===n.length&&s()}))}})):[]}async function R(t,e){const n=await z(t,e);if(!n.length){const n=t=>(t.shortcodes||[]).includes(e.toLowerCase());return await async function(t,e){return L(t,a,_,((t,n,o)=>{let r;const s=()=>{t.getAll(r&&IDBKeyRange.lowerBound(r,!0),50).onsuccess=t=>{const n=t.target.result;for(const s of n)if(r=s.unicode,e(s))return o(s);if(n.length<50)return o();s()}};s()}))}(t,n)||null}return n.filter((t=>{const n=(t.shortcodes||[]).map((t=>t.toLowerCase()));return n.includes(e.toLowerCase())}))[0]||null}function F(t,e,n){return L(t,e,_,((t,e,o)=>I(t,n,o)))}const H="";const J=["name","url"];function Z(t){!function(t){const e=t&&Array.isArray(t),n=e&&t.length&&(!t[0]||J.some((e=>!(e in t[0]))));if(!e||n)throw new Error("Custom emojis are in the wrong format")}(t);const e=(t,e)=>t.name.toLowerCase()<e.name.toLowerCase()?-1:1,n=t.sort(e),o=function(t,e){const n=new Map;for(const o of t){const t=e(o);for(const e of t){let t=n;for(let n=0;n<e.length;n++){const o=e.charAt(n);let r=t.get(o);r||(r=new Map,t.set(o,r)),t=r}let r=t.get(H);r||(r=[],t.set(H,r)),r.push(o)}}return(t,e)=>{let o=n;for(let n=0;n<t.length;n++){const e=t.charAt(n),r=o.get(e);if(!r)return[];o=r}if(e)return o.get(H)||[];const r=[],s=[o];for(;s.length;){const t=[...s.shift().entries()].sort(((t,e)=>t[0]<e[0]?-1:1));for(const[e,n]of t)e===H?r.push(...n):s.push(n)}return r}}(t,(t=>[...new Set((t.shortcodes||[]).map((t=>T(t))).flat())])),r=t=>o(t,!0),s=t=>o(t,!1),i=new Map,a=new Map;for(const c of t){a.set(c.name.toLowerCase(),c);for(const t of c.shortcodes||[])i.set(t.toLowerCase(),c)}return{all:n,search:t=>{const n=T(t);return V(n.map(((t,e)=>(e<n.length-1?r:s)(t))),(t=>t.name)).sort(e)},byShortcode:t=>i.get(t.toLowerCase()),byName:t=>a.get(t.toLowerCase())}}const G="undefined"!=typeof wrappedJSObject;function Q(t){if(!t)return t;if(G&&(t=structuredClone(t)),delete t.tokens,t.skinTones){const e=t.skinTones.length;t.skins=Array(e);for(let n=0;n<e;n++)t.skins[n]={tone:t.skinTones[n],unicode:t.skinUnicodes[n],version:t.skinVersions[n]};delete t.skinTones,delete t.skinUnicodes,delete t.skinVersions}return t}function $(t){t||console.warn("emoji-picker-element is more efficient if the dataSource server exposes an ETag header.")}const q=["annotation","emoji","group","order","tags","version"];function W(t,e){if(2!==Math.floor(t.status/100))throw new Error("Failed to fetch: "+e+":  "+t.status)}async function Y(t){const e=await fetch(t);W(e,t);const n=e.headers.get("etag");$(n);const o=await e.json();return function(t){if(!t||!Array.isArray(t)||!t[0]||"object"!=typeof t[0]||q.some((e=>!(e in t[0]))))throw new Error("Emoji data is in the wrong format")}(o),[n,o]}async function tt(t){const e=function(t){for(var e=t.length,n=new ArrayBuffer(e),o=new Uint8Array(n),r=-1;++r<e;)o[r]=t.charCodeAt(r);return n}(JSON.stringify(t)),n=function(t){for(var e="",n=new Uint8Array(t),o=n.byteLength,r=-1;++r<o;)e+=String.fromCharCode(n[r]);return e}(await crypto.subtle.digest("SHA-1",e));return btoa(n)}async function et(t,e){let n,o=await async function(t){const e=await fetch(t,{method:"HEAD"});W(e,t);const n=e.headers.get("etag");return $(n),n}(e);if(!o){const t=await Y(e);o=t[0],n=t[1],o||(o=await tt(n))}if(await async function(t,e,n){const[o,r]=await Promise.all([p,g].map((e=>F(t,c,e))));return o===n&&r===e}(t,e,o));else{if(!n){n=(await Y(e))[1]}await X(t,n,e,o)}}class nt{constructor({dataSource:t="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",locale:e="en",customEmoji:n=[]}={}){this.dataSource=t,this.locale=e,this._dbName=`emoji-picker-element-${this.locale}`,this._db=void 0,this._lazyUpdate=void 0,this._custom=Z(n),this._clear=this._clear.bind(this),this._ready=this._init()}async _init(){const t=this._db=await(e=this._dbName,E[e]||(E[e]=D(e)),E[e]);var e;!function(t,e){let n=B[t];n||(n=B[t]=[]),n.push(e)}(this._dbName,this._clear);const n=this.dataSource,o=await async function(t){return!(await F(t,c,g))}(t);o?await async function(t,e){let[n,o]=await Y(e);n||(n=await tt(o)),await X(t,o,e,n)}(t,n):this._lazyUpdate=et(t,n)}async ready(){const t=async()=>(this._ready||(this._ready=this._init()),this._ready);await t(),this._db||await t()}async getEmojiByGroup(t){return r(t),await this.ready(),S(await async function(t,e){return L(t,a,_,((t,n,o)=>{const r=IDBKeyRange.bound([e,0],[e+1,0],!1,!0);M(t.index(m),r,o)}))}(this._db,t)).map(Q)}async getEmojiBySearchQuery(t){o(t),await this.ready();return[...this._custom.search(t),...S(await z(this._db,t)).map(Q)]}async getEmojiByShortcode(t){o(t),await this.ready();const e=this._custom.byShortcode(t);return e||Q(await R(this._db,t))}async getEmojiByUnicodeOrName(t){o(t),await this.ready();const e=this._custom.byName(t);return e||Q(await async function(t,e){return L(t,a,_,((t,n,o)=>I(t,e,(n=>{if(n)return o(n);I(t.index(j),e,(t=>o(t||null)))}))))}(this._db,t))}async getPreferredSkinTone(){return await this.ready(),await F(this._db,c,b)||0}async setPreferredSkinTone(t){return r(t),await this.ready(),e=this._db,n=b,o=t,L(e,c,k,((t,e)=>{t.put(o,n),K(e)}));var e,n,o}async incrementFavoriteEmojiCount(t){return o(t),await this.ready(),e=this._db,n=t,L(e,u,k,((t,e)=>I(t,n,(o=>{t.put((o||0)+1,n),K(e)}))));var e,n}async getTopFavoriteEmoji(t){return r(t),await this.ready(),(await function(t,e,n){return 0===n?[]:L(t,[u,a],_,(([t,o],r,s)=>{const i=[];t.index(l).openCursor(void 0,"prev").onsuccess=t=>{const r=t.target.result;if(!r)return s(i);function a(t){if(i.push(t),i.length===n)return s(i);r.continue()}const c=r.primaryKey,u=e.byName(c);if(u)return a(u);I(o,c,(t=>{if(t)return a(t);r.continue()}))}}))}(this._db,this._custom,t)).map(Q)}set customEmoji(t){this._custom=Z(t)}get customEmoji(){return this._custom.all}async _shutdown(){await this.ready();try{await this._lazyUpdate}catch(t){}}_clear(){this._db=this._ready=this._lazyUpdate=void 0}async close(){await this._shutdown(),await x(this._dbName)}async delete(){var t;await this._shutdown(),await(t=this._dbName,new Promise(((e,n)=>{x(t),A(e,n,indexedDB.deleteDatabase(t))})))}}}}]);
//# sourceMappingURL=8289.967fc56a88455ba86630.8289.js.map