{"version":3,"file":"blurhash.ee398501b782c72327f7.blurhash.js","mappings":"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","sources":["webpack:///./node_modules/promise-worker/register.js","webpack:///webpack/bootstrap","webpack:///webpack/runtime/compat get default export","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///./node_modules/fast-blurhash/index.js","webpack:///./src/routes/_static/blurhash.js","webpack:///./src/routes/_utils/thunk.js","webpack:///./src/routes/_utils/userAgent/isChrome.js","webpack:///./src/routes/_utils/userAgent/isChromePre82.js","webpack:///./src/routes/_workers/blurhash.js"],"sourcesContent":["'use strict'\n\nfunction isPromise (obj) {\n  // via https://unpkg.com/is-promise@2.1.0/index.js\n  return !!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function'\n}\n\nfunction registerPromiseWorker (callback) {\n  function postOutgoingMessage (e, messageId, error, result) {\n    function postMessage (msg) {\n      /* istanbul ignore if */\n      if (typeof self.postMessage !== 'function') { // service worker\n        e.ports[0].postMessage(msg)\n      } else { // web worker\n        self.postMessage(msg)\n      }\n    }\n    if (error) {\n      /* istanbul ignore else */\n      if (typeof console !== 'undefined' && 'error' in console) {\n        // This is to make errors easier to debug. I think it's important\n        // enough to just leave here without giving the user an option\n        // to silence it.\n        console.error('Worker caught an error:', error)\n      }\n      postMessage([messageId, {\n        message: error.message\n      }])\n    } else {\n      postMessage([messageId, null, result])\n    }\n  }\n\n  function tryCatchFunc (callback, message) {\n    try {\n      return { res: callback(message) }\n    } catch (e) {\n      return { err: e }\n    }\n  }\n\n  function handleIncomingMessage (e, callback, messageId, message) {\n    var result = tryCatchFunc(callback, message)\n\n    if (result.err) {\n      postOutgoingMessage(e, messageId, result.err)\n    } else if (!isPromise(result.res)) {\n      postOutgoingMessage(e, messageId, null, result.res)\n    } else {\n      result.res.then(function (finalResult) {\n        postOutgoingMessage(e, messageId, null, finalResult)\n      }, function (finalError) {\n        postOutgoingMessage(e, messageId, finalError)\n      })\n    }\n  }\n\n  function onIncomingMessage (e) {\n    var payload = e.data\n    if (!Array.isArray(payload) || payload.length !== 2) {\n      // message doens't match communication format; ignore\n      return\n    }\n    var messageId = payload[0]\n    var message = payload[1]\n\n    if (typeof callback !== 'function') {\n      postOutgoingMessage(e, messageId, new Error(\n        'Please pass a function into register().'))\n    } else {\n      handleIncomingMessage(e, callback, messageId, message)\n    }\n  }\n\n  self.addEventListener('message', onIncomingMessage)\n}\n\nmodule.exports = registerPromiseWorker\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const digit =\n    '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz#$%*+,-.:;=?@[]^_{|}~';\nconst decode83 = (str, start, end) => {\n    let value = 0;\n    while (start < end) {\n        value *= 83;\n        value += digit.indexOf(str[start++]);\n    }\n    return value;\n};\n\nconst pow = Math.pow;\nconst PI = Math.PI;\nconst PI2 = PI * 2;\n\nconst d = 3294.6;\nconst e = 269.025;\nconst sRGBToLinear = (value) =>\n    value > 10.31475 ? pow(value / e + 0.052132, 2.4) : value / d;\n\nconst linearTosRGB = (v) =>\n    ~~(v > 0.00001227 ? e * pow(v, 0.416666) - 13.025 : v * d + 1);\n\nconst signSqr = (x) => (x < 0 ? -1 : 1) * x * x;\n\n/**\n * Fast approximate cosine implementation\n * Based on FTrig https://github.com/netcell/FTrig\n */\nconst fastCos = (x) => {\n    x += PI / 2;\n    while (x > PI) {\n        x -= PI2;\n    }\n    const cos = 1.27323954 * x - 0.405284735 * signSqr(x);\n    return 0.225 * (signSqr(cos) - cos) + cos;\n};\n\n/**\n * Extracts average color from BlurHash image\n * @param {string} blurHash BlurHash image string\n * @returns {[number, number, number]}\n */\nexport function getBlurHashAverageColor(blurHash) {\n    const val = decode83(blurHash, 2, 6);\n    return [val >> 16, (val >> 8) & 255, val & 255];\n}\n\n/**\n * Decodes BlurHash image\n * @param {string} blurHash BlurHash image string\n * @param {number} width Output image width\n * @param {number} height Output image height\n * @param {?number} punch\n * @returns {Uint8ClampedArray}\n */\nexport function decodeBlurHash(blurHash, width, height, punch) {\n    const sizeFlag = decode83(blurHash, 0, 1);\n    const numX = (sizeFlag % 9) + 1;\n    const numY = ~~(sizeFlag / 9) + 1;\n    const size = numX * numY;\n\n    let i = 0,\n        j = 0,\n        x = 0,\n        y = 0,\n        r = 0,\n        g = 0,\n        b = 0,\n        basis = 0,\n        basisY = 0,\n        colorIndex = 0,\n        pixelIndex = 0,\n        yh = 0,\n        xw = 0,\n        value = 0;\n\n    const maximumValue = ((decode83(blurHash, 1, 2) + 1) / 13446) * (punch | 1);\n\n    const colors = new Float64Array(size * 3);\n\n    const averageColor = getBlurHashAverageColor(blurHash);\n    for (i = 0; i < 3; i++) {\n        colors[i] = sRGBToLinear(averageColor[i]);\n    }\n\n    for (i = 1; i < size; i++) {\n        value = decode83(blurHash, 4 + i * 2, 6 + i * 2);\n        colors[i * 3] = signSqr(~~(value / (19 * 19)) - 9) * maximumValue;\n        colors[i * 3 + 1] = signSqr((~~(value / 19) % 19) - 9) * maximumValue;\n        colors[i * 3 + 2] = signSqr((value % 19) - 9) * maximumValue;\n    }\n\n    const bytesPerRow = width * 4;\n    const pixels = new Uint8ClampedArray(bytesPerRow * height);\n\n    for (y = 0; y < height; y++) {\n        yh = (PI * y) / height;\n        for (x = 0; x < width; x++) {\n            r = 0;\n            g = 0;\n            b = 0;\n            xw = (PI * x) / width;\n\n            for (j = 0; j < numY; j++) {\n                basisY = fastCos(yh * j);\n                for (i = 0; i < numX; i++) {\n                    basis = fastCos(xw * i) * basisY;\n                    colorIndex = (i + j * numX) * 3;\n                    r += colors[colorIndex] * basis;\n                    g += colors[colorIndex + 1] * basis;\n                    b += colors[colorIndex + 2] * basis;\n                }\n            }\n\n            pixelIndex = 4 * x + y * bytesPerRow;\n            pixels[pixelIndex] = linearTosRGB(r);\n            pixels[pixelIndex + 1] = linearTosRGB(g);\n            pixels[pixelIndex + 2] = linearTosRGB(b);\n            pixels[pixelIndex + 3] = 255; // alpha\n        }\n    }\n    return pixels;\n}\n","export const RESOLUTION = 32\n","// Run a function once, then cache the result and return the cached result thereafter\nexport function thunk (func) {\n  let cached\n  let runOnce\n  return () => {\n    if (!runOnce) {\n      cached = func()\n      runOnce = true\n    }\n    return cached\n  }\n}\n","import { thunk } from '../thunk.js'\n\nexport const isChrome = thunk(() => process.browser && /Chrome/.test(navigator.userAgent))\n","// checking for Chrome 82 because that's when this bug was fixed\n// https://bugs.chromium.org/p/chromium/issues/detail?id=1053477\n\nimport { thunk } from '../thunk.js'\nimport { isChrome } from './isChrome.js'\n\nfunction getChromeVersion () {\n  try {\n    return parseInt(navigator.userAgent.match(/Chrome\\/(\\d+)/)[1], 10) || undefined\n  } catch (e) {\n    return undefined\n  }\n}\n\nexport const isChromePre82 = thunk(() => process.browser && isChrome() && getChromeVersion() < 82)\n","import { decodeBlurHash } from 'fast-blurhash'\nimport registerPromiseWorker from 'promise-worker/register.js'\nimport { RESOLUTION } from '../_static/blurhash.js'\nimport { isChromePre82 } from '../_utils/userAgent/isChromePre82.js'\n\n// Disabled in Chrome because convertToBlob() is slow\nconst OFFSCREEN_CANVAS = !isChromePre82() && typeof OffscreenCanvas === 'function'\n  ? new OffscreenCanvas(RESOLUTION, RESOLUTION)\n  : null\nconst OFFSCREEN_CANVAS_CONTEXT_2D = OFFSCREEN_CANVAS\n  ? OFFSCREEN_CANVAS.getContext('2d')\n  : null\n\nregisterPromiseWorker(async (encoded) => {\n  const pixels = decodeBlurHash(encoded, RESOLUTION, RESOLUTION)\n\n  if (!pixels) {\n    throw new Error('decode did not return any pixels')\n  }\n  const imageData = new ImageData(pixels, RESOLUTION, RESOLUTION)\n\n  if (OFFSCREEN_CANVAS) {\n    OFFSCREEN_CANVAS_CONTEXT_2D.putImageData(imageData, 0, 0)\n    const blob = await OFFSCREEN_CANVAS.convertToBlob()\n    const decoded = await new Promise((resolve, reject) => {\n      const reader = new self.FileReader()\n      reader.addEventListener('error', () => {\n        reject(reader.error)\n      })\n      reader.addEventListener('load', () => {\n        resolve(reader.result)\n      })\n      reader.readAsDataURL(blob)\n    })\n    return { decoded, imageData: null }\n  } else {\n    return { imageData, decoded: null }\n  }\n})\n"],"names":["module","exports","callback","postOutgoingMessage","e","messageId","error","result","postMessage","msg","self","ports","console","message","addEventListener","payload","data","Array","isArray","length","Error","obj","res","err","tryCatchFunc","then","finalResult","finalError","handleIncomingMessage","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","prop","prototype","hasOwnProperty","call","decode83","str","start","end","value","indexOf","pow","Math","PI","PI2","sRGBToLinear","linearTosRGB","v","signSqr","x","fastCos","cos","decodeBlurHash","blurHash","width","height","punch","sizeFlag","numX","numY","size","i","j","y","r","g","b","basis","basisY","colorIndex","pixelIndex","yh","xw","maximumValue","colors","Float64Array","averageColor","val","getBlurHashAverageColor","bytesPerRow","pixels","Uint8ClampedArray","RESOLUTION","thunk","func","cached","runOnce","isChrome","test","navigator","userAgent","OFFSCREEN_CANVAS","parseInt","match","getChromeVersion","isChromePre82","OffscreenCanvas","OFFSCREEN_CANVAS_CONTEXT_2D","getContext","async","encoded","imageData","ImageData","putImageData","blob","convertToBlob","decoded","Promise","resolve","reject","reader","FileReader","readAsDataURL"],"sourceRoot":""}