"use strict";(this.webpackChunk=this.webpackChunk||[]).push([[135],{135:(t,e,a)=>{a.r(e),a.d(e,{default:()=>ut});var i=a(4178),r=a(3582),s=a(9065),n=a(2771),o=a(6288),d=a(5524),l=a(85),c=a(1372),m=a(9970),h=a(2755),f=a(8552),g=a(7687),u=a(7041),p=a(7686);const x="function"==typeof PointerEvent,v="ontouchstart"in document&&!/Epiphany/.test(navigator.userAgent);let y,b,w,_;function I(t){return(e,a)=>{const i=t=>{"number"!=typeof t.clientX&&(t.clientX=(0,l.U2)(t,["touches",0,"clientX"])),"number"!=typeof t.clientY&&(t.clientY=(0,l.U2)(t,["touches",0,"clientY"])),a(t)};return e.addEventListener(t,i),{destroy(){e.removeEventListener(t,i)}}}}x?(y=I("pointerdown"),b=I("pointerup"),w=I("pointerleave"),_=I("pointermove")):v?(y=I("touchstart"),b=I("touchend"),w=I("touchend"),_=I("touchmove")):(y=I("mousedown"),b=I("mouseup"),w=I("mouseleave"),_=I("mousemove"));var R=a(101),N=a(658);const E=(0,p.g)(requestAnimationFrame),L=(0,p.g)(requestAnimationFrame),C=(0,p.g)(requestAnimationFrame),S=(0,p.g)(R.b),$=t=>Math.max(0,Math.min(1,t));var A={observe:c.N7,onPointerDown(t){const e=this.refs.indicator.getBoundingClientRect();t.clientX,t.clientY,this.set({dragging:!0,dragOffsetX:t.clientX-e.left,dragOffsetY:t.clientY-e.top})},onPointerMove(t){const{dragging:e,indicatorWidth:a,indicatorHeight:i,dragOffsetX:r,dragOffsetY:s}=this.get();e&&S((()=>{const e=this.refs.area.getBoundingClientRect(),n=r-a/2,o=s-i/2,d=$((t.clientX-e.left-n)/e.width),l=$((t.clientY-e.top-o)/e.height);this.set({x:d,y:l})}))},onPointerUp(t){this.set({dragging:!1})},onPointerLeave(t){this.set({dragging:!1})},onClick(t){if(t.target.classList,t.currentTarget.classList,!t.target.classList.contains("draggable-indicator")){const e=this.refs.area.getBoundingClientRect(),a=$((t.clientX-e.left)/e.width),i=$((t.clientY-e.top)/e.height);this.set({x:a,y:i}),this.fire("change",{x:a,y:i})}}};function z(){this.observe("dragging",(t=>{if(t)this.fire("dragStart");else{const{x:t,y:e}=this.get();this.fire("dragEnd"),this.fire("change",{x:t,y:e})}}),{init:!1}),this.observe("indicatorStyle",(()=>{E((()=>{const{indicatorStyle:t}=this.get();this.set({indicatorStyleAfterRaf:t})}))})),this.observe("computedIndicatorClass",(()=>{L((()=>{const{computedIndicatorClass:t}=this.get();this.set({computedIndicatorClassAfterRaf:t})}))})),this.observe("draggableClass",(()=>{C((()=>{const{draggableClass:t}=this.get();this.set({draggableClassAfterRaf:t})}))}))}function T(t){var e;if((0,i.S1)(this,t),this.refs={},this._state=(0,i.f0)({dragging:!1,draggableClass:"",draggableClassAfterRaf:"",indicatorClass:"",computedIndicatorClassAfterRaf:"",x:0,y:0,indicatorWidth:0,indicatorHeight:0,indicatorStyleAfterRaf:""},t.data),this._recompute({x:1,y:1,indicatorWidth:1,indicatorHeight:1,dragging:1,indicatorClass:1},this._state),this._intro=!0,this._slotted=t.slots||{},document.getElementById("svelte-1n5qqyg-style")||((e=(0,i.az)("style")).id="svelte-1n5qqyg-style",e.textContent=".draggable-area.svelte-1n5qqyg{position:relative;touch-action:none;cursor:pointer}.draggable-indicator.svelte-1n5qqyg{position:absolute;cursor:grab}.draggable-indicator.grabbing.svelte-1n5qqyg{cursor:grabbing}.draggable-indicator-inner.svelte-1n5qqyg{pointer-events:none;display:flex}",(0,i.R3)(document.head,e)),this._fragment=function(t,e){var a,r,s,n,o,d,l,c,m,h=t._slotted.default;function f(e){t.onClick(e)}return{c(){a=(0,i.az)("div"),r=(0,i.az)("div"),s=(0,i.az)("div"),this.h()},l(t){a=(0,i.d$)(t,"DIV",{class:!0},!1);var e=(0,i.pI)(a);r=(0,i.d$)(e,"DIV",{class:!0,style:!0},!1);var n=(0,i.pI)(r);s=(0,i.d$)(n,"DIV",{class:!0},!1),(0,i.pI)(s).forEach(i.r2),n.forEach(i.r2),e.forEach(i.r2),this.h()},h(){s.className="draggable-indicator-inner svelte-1n5qqyg",n=y.call(t,r,(function(e){t.onPointerDown(e)})),r.className=o="draggable-indicator "+e.computedIndicatorClassAfterRaf+" svelte-1n5qqyg",r.style.cssText=e.indicatorStyleAfterRaf,d=_.call(t,a,(function(e){t.onPointerMove(e)})),l=w.call(t,a,(function(e){t.onPointerLeave(e)})),c=b.call(t,a,(function(e){t.onPointerUp(e)})),(0,i.NH)(a,"click",f),a.className=m="draggable-area "+e.draggableClassAfterRaf+" svelte-1n5qqyg"},m(e,n){(0,i.$T)(e,a,n),(0,i.R3)(a,r),(0,i.R3)(r,s),h&&(0,i.R3)(s,h),t.refs.indicator=r,t.refs.area=a},p(t,e){t.computedIndicatorClassAfterRaf&&o!==(o="draggable-indicator "+e.computedIndicatorClassAfterRaf+" svelte-1n5qqyg")&&(r.className=o),t.indicatorStyleAfterRaf&&(r.style.cssText=e.indicatorStyleAfterRaf),t.draggableClassAfterRaf&&m!==(m="draggable-area "+e.draggableClassAfterRaf+" svelte-1n5qqyg")&&(a.className=m)},d(e){e&&(0,i.r2)(a),h&&(0,i.R_)(s,h),n.destroy(),t.refs.indicator===r&&(t.refs.indicator=null),d.destroy(),l.destroy(),c.destroy(),(0,i.ys)(a,"click",f),t.refs.area===a&&(t.refs.area=null)}}}(this,this._state),this.root._oncreate.push((()=>{z.call(this),this.fire("update",{changed:(0,i.lZ)({},this._state),current:this._state})})),t.target){var a=(0,i.pI)(t.target);t.hydrate?this._fragment.l(a):this._fragment.c(),a.forEach(i.r2),this._mount(t.target,t.anchor),(0,i.yl)(this)}}(0,i.f0)(T.prototype,i.uS),(0,i.f0)(T.prototype,A),T.prototype._recompute=function(t,e){(t.x||t.y||t.indicatorWidth||t.indicatorHeight)&&this._differs(e.indicatorStyle,e.indicatorStyle=function({x:t,y:e,indicatorWidth:a,indicatorHeight:i}){return`left: calc(${100*t}% - ${a/2}px); top: calc(${100*e}% - ${i/2}px);`}(e))&&(t.indicatorStyle=!0),(t.dragging||t.indicatorClass)&&this._differs(e.computedIndicatorClass,e.computedIndicatorClass=function({dragging:t,indicatorClass:e}){return(0,N.q)(t&&"grabbing",e)}(e))&&(t.computedIndicatorClass=!0)};const X=T,Y=t=>{let e=parseFloat(t);return Number.isNaN(e)&&(e=0),e=Math.min(1,e),e=Math.max(-1,e),e=Math.round(100*e)/100,e};var F={observe:c.N7,setupSyncFromStore(){this.observe("mediaItem",(t=>{const{rawFocusX:e,rawFocusY:a}=this.get(),i=(e,a,i)=>{const r=((0,l.U2)(t,[i],0)||0).toString();r!==a&&this.set({[e]:r})};i("rawFocusX",e,"focusX"),i("rawFocusY",a,"focusY")}))},setupSyncToStore(){const t=(t,e)=>{this.observe(t,(t=>{const{realm:a,index:i,media:r}=this.get(),s=Y(t);r[i][e]!==s&&(r[i][e]=s,this.store.setComposeData(a,{media:r}),(0,m.F)((()=>this.store.save())))}),{init:!1})};t("rawFocusX","focusX"),t("rawFocusY","focusY")},onDraggableChange({x:t,y:e}){(0,m.F)((()=>{const a=Y((0,h.s)(100*t)),i=Y((0,h.s)(100-100*e)),{realm:r,index:s,media:n}=this.get();n[s].focusX===a&&n[s].focusY===i||(n[s].focusX=a,n[s].focusY=i,this.store.setComposeData(r,{media:n}),(0,m.F)((()=>this.store.save())))}))},onDragStart(){this.set({dragging:!0})},onDragEnd(){this.set({dragging:!1})},measure(){requestAnimationFrame((()=>{if(!this.refs.container)return;const t=this.refs.container.getBoundingClientRect();this.set({containerWidth:t.width,containerHeight:t.height})}))},onImageLoad(){this.measure(),this.set({imageLoaded:!0})}};function H(){this.setupSyncFromStore(),this.setupSyncToStore()}function j(t){var e;if((0,i.S1)(this,t),this.store=d.h,this.refs={},this._state=(0,i.f0)({dragging:!1,rawFocusX:"0",rawFocusY:"0",containerWidth:0,containerHeight:0,imageLoaded:!1,className:""},t.data),this._recompute({media:1,index:1,mediaItem:1,nativeWidth:1,nativeHeight:1,containerWidth:1,containerHeight:1,scale:1,focusX:1,focusY:1,scaleWidth:1,scaleHeight:1,scaleX:1,scaleY:1},this._state),this._intro=!0,document.getElementById("svelte-76ojx3-style")||((e=(0,i.az)("style")).id="svelte-76ojx3-style",e.textContent=".media-focal-point-container.svelte-76ojx3{display:flex;flex-direction:column;overflow:hidden}.media-focal-point-image-container.svelte-76ojx3{flex:1;width:100%;position:relative;min-height:0}.media-focal-point-image.svelte-76ojx3{object-fit:contain;width:100%;height:100%}.media-focal-point-backdrop.svelte-76ojx3{position:absolute;left:0;right:0;bottom:0;top:0}@supports (-webkit-backdrop-filter: blur(1px) saturate(1%)) or (backdrop-filter: blur(1px) saturate(1%)){.media-focal-point-backdrop.svelte-76ojx3{-webkit-backdrop-filter:blur(1px) saturate(105%);backdrop-filter:blur(1px) saturate(105%);background-color:var(--focal-img-backdrop-filter)}}@supports not ((-webkit-backdrop-filter: blur(1px) saturate(1%)) or (backdrop-filter: blur(1px) saturate(1%))){.media-focal-point-backdrop.svelte-76ojx3{background-color:var(--focal-img-bg)}}.media-focal-point-inputs.svelte-76ojx3{display:flex;padding:10px;justify-content:space-around;width:auto}.media-focal-point-input-pair.svelte-76ojx3{display:flex;align-items:center;flex-grow:1}.media-focal-point-input-pair.svelte-76ojx3:first-child{margin-right:10px}.media-focal-point-input-pair.svelte-76ojx3 input.svelte-76ojx3{margin-left:10px;width:0;flex-grow:1}.media-draggable-area.svelte-76ojx3{position:absolute}.media-focal-point-indicator{background:var(--focal-bg);border-radius:100%;display:flex}.media-focal-point-indicator:hover{background:var(--focal-bg-hover)}.media-focal-point-indicator.dragging{background:var(--focal-bg-drag)}.media-draggable-area-inner{width:100%;height:100%}.media-focal-point-indicator-svg{width:32px;height:32px;padding:15px;fill:var(--focal-color)}@media(max-width: 767px){.media-focal-point-inputs.svelte-76ojx3{padding:5px 20px;justify-content:space-around}.media-focal-point-indicator-svg{width:32px;height:32px;padding:12px;fill:var(--focal-color)}.media-focal-point-input-pair.svelte-76ojx3 label.svelte-76ojx3{font-size:1.1em}.media-focal-point-input-pair.svelte-76ojx3 input.svelte-76ojx3{font-size:1.1em}}",(0,i.R3)(document.head,e)),this._fragment=function(t,e){var a,r,s,n,o,d,l,c,m,h,g,p,x,v,y,b,w,_,I,R,N,E,L,C,S,$,A=!1,z=!1;function T(e){t.onImageLoad()}var Y=new f.Z({root:t.root,store:t.store,data:{className:"media-focal-point-indicator-svg",href:"#fa-crosshairs"}}),F={draggableClass:"media-draggable-area-inner",indicatorClass:"media-focal-point-indicator "+(e.imageLoaded?"":"hidden")+" "+(e.dragging?"dragging":""),indicatorWidth:52,indicatorHeight:52,x:e.indicatorX,y:e.indicatorY},H=new X({root:t.root,store:t.store,slots:{default:(0,i.xJ)()},data:F});function j(){A=!0,t.set({rawFocusX:(0,i.He)(y.value)}),A=!1}function k(){z=!0,t.set({rawFocusY:(0,i.He)(L.value)}),z=!1}return H.on("dragStart",(function(e){t.onDragStart()})),H.on("dragEnd",(function(e){t.onDragEnd()})),H.on("change",(function(e){t.onDraggableChange(e)})),{c(){a=(0,i.az)("form"),r=(0,i.az)("div"),s=(0,i.az)("img"),n=(0,i.rw)("\n    "),o=(0,i.az)("div"),d=(0,i.rw)("\n    "),l=(0,i.az)("div"),Y._fragment.c(),H._fragment.c(),c=(0,i.rw)("\n  "),m=(0,i.az)("div"),h=(0,i.az)("div"),g=(0,i.az)("label"),p=(0,i.rw)("X"),v=(0,i.rw)("\n      "),y=(0,i.az)("input"),w=(0,i.rw)("\n    "),_=(0,i.az)("div"),I=(0,i.az)("label"),R=(0,i.rw)("Y"),E=(0,i.rw)("\n      "),L=(0,i.az)("input"),this.h()},l(t){a=(0,i.d$)(t,"FORM",{class:!0,"aria-label":!0},!1);var e=(0,i.pI)(a);r=(0,i.d$)(e,"DIV",{class:!0},!1);var f=(0,i.pI)(r);s=(0,i.d$)(f,"IMG",{width:!0,height:!0,class:!0,src:!0,alt:!0},!1),(0,i.pI)(s).forEach(i.r2),n=(0,i.M4)(f,"\n    "),o=(0,i.d$)(f,"DIV",{class:!0},!1),(0,i.pI)(o).forEach(i.r2),d=(0,i.M4)(f,"\n    "),l=(0,i.d$)(f,"DIV",{class:!0,style:!0},!1);var u=(0,i.pI)(l);Y._fragment.l(t),H._fragment.l(u),u.forEach(i.r2),f.forEach(i.r2),c=(0,i.M4)(e,"\n  "),m=(0,i.d$)(e,"DIV",{class:!0},!1);var x=(0,i.pI)(m);h=(0,i.d$)(x,"DIV",{class:!0},!1);var b=(0,i.pI)(h);g=(0,i.d$)(b,"LABEL",{for:!0,class:!0},!1);var N=(0,i.pI)(g);p=(0,i.M4)(N,"X"),N.forEach(i.r2),v=(0,i.M4)(b,"\n      "),y=(0,i.d$)(b,"INPUT",{type:!0,step:!0,min:!0,max:!0,inputmode:!0,placeholder:!0,id:!0,class:!0},!1),(0,i.pI)(y).forEach(i.r2),b.forEach(i.r2),w=(0,i.M4)(x,"\n    "),_=(0,i.d$)(x,"DIV",{class:!0},!1);var C=(0,i.pI)(_);I=(0,i.d$)(C,"LABEL",{for:!0,class:!0},!1);var S=(0,i.pI)(I);R=(0,i.M4)(S,"Y"),S.forEach(i.r2),E=(0,i.M4)(C,"\n      "),L=(0,i.d$)(C,"INPUT",{type:!0,step:!0,min:!0,max:!0,inputmode:!0,placeholder:!0,id:!0,class:!0},!1),(0,i.pI)(L).forEach(i.r2),C.forEach(i.r2),x.forEach(i.r2),e.forEach(i.r2),this.h()},h(){(0,i.NH)(s,"load",T),s.width=e.intrinsicWidth,s.height=e.intrinsicHeight,s.className="media-focal-point-image svelte-76ojx3",s.src=e.previewSrc,s.alt=e.shortName,o.className="media-focal-point-backdrop svelte-76ojx3",l.className="media-draggable-area svelte-76ojx3",l.style.cssText=e.draggableAreaStyle,r.className="media-focal-point-image-container svelte-76ojx3",g.htmlFor=x="media-focal-point-x-input-"+e.realm,g.className="svelte-76ojx3",(0,i.NH)(y,"input",j),(0,i.P$)(y,"type","number"),y.step="0.01",y.min="-1",y.max="1",(0,i.P$)(y,"inputmode","decimal"),y.placeholder="0",y.id=b="media-focal-point-x-input-"+e.realm,y.className="svelte-76ojx3",h.className="media-focal-point-input-pair svelte-76ojx3",I.htmlFor=N="media-focal-point-y-input-"+e.realm,I.className="svelte-76ojx3",(0,i.NH)(L,"input",k),(0,i.P$)(L,"type","number"),L.step="0.01",L.min="-1",L.max="1",(0,i.P$)(L,"inputmode","decimal"),L.placeholder="0",L.id=C="media-focal-point-y-input-"+e.realm,L.className="svelte-76ojx3",_.className="media-focal-point-input-pair svelte-76ojx3",m.className="media-focal-point-inputs svelte-76ojx3",S=u.SI.call(t,a,(function(e){t.measure()})),a.className=$="media-focal-point-container "+e.className+" svelte-76ojx3",(0,i.P$)(a,"aria-label","Enter the focal point (X, Y) for this media")},m(f,u){(0,i.$T)(f,a,u),(0,i.R3)(a,r),(0,i.R3)(r,s),(0,i.R3)(r,n),(0,i.R3)(r,o),(0,i.R3)(r,d),(0,i.R3)(r,l),Y._mount(H._slotted.default,null),H._mount(l,null),t.refs.container=r,(0,i.R3)(a,c),(0,i.R3)(a,m),(0,i.R3)(m,h),(0,i.R3)(h,g),(0,i.R3)(g,p),(0,i.R3)(h,v),(0,i.R3)(h,y),y.value=e.rawFocusX,(0,i.R3)(m,w),(0,i.R3)(m,_),(0,i.R3)(_,I),(0,i.R3)(I,R),(0,i.R3)(_,E),(0,i.R3)(_,L),L.value=e.rawFocusY},p(t,e){t.intrinsicWidth&&(s.width=e.intrinsicWidth),t.intrinsicHeight&&(s.height=e.intrinsicHeight),t.previewSrc&&(s.src=e.previewSrc),t.shortName&&(s.alt=e.shortName);var i={};(t.imageLoaded||t.dragging)&&(i.indicatorClass="media-focal-point-indicator "+(e.imageLoaded?"":"hidden")+" "+(e.dragging?"dragging":"")),t.indicatorX&&(i.x=e.indicatorX),t.indicatorY&&(i.y=e.indicatorY),H._set(i),t.draggableAreaStyle&&(l.style.cssText=e.draggableAreaStyle),t.realm&&x!==(x="media-focal-point-x-input-"+e.realm)&&(g.htmlFor=x),!A&&t.rawFocusX&&(y.value=e.rawFocusX),t.realm&&b!==(b="media-focal-point-x-input-"+e.realm)&&(y.id=b),t.realm&&N!==(N="media-focal-point-y-input-"+e.realm)&&(I.htmlFor=N),!z&&t.rawFocusY&&(L.value=e.rawFocusY),t.realm&&C!==(C="media-focal-point-y-input-"+e.realm)&&(L.id=C),t.className&&$!==($="media-focal-point-container "+e.className+" svelte-76ojx3")&&(a.className=$)},d(e){e&&(0,i.r2)(a),(0,i.ys)(s,"load",T),Y.destroy(),H.destroy(),t.refs.container===r&&(t.refs.container=null),(0,i.ys)(y,"input",j),(0,i.ys)(L,"input",k),S.destroy()}}}(this,this._state),this.root._oncreate.push((()=>{H.call(this),this.fire("update",{changed:(0,i.lZ)({},this._state),current:this._state})})),t.target){var a=(0,i.pI)(t.target);t.hydrate?this._fragment.l(a):this._fragment.c(),a.forEach(i.r2),this._mount(t.target,t.anchor),(0,i.yl)(this)}}(0,i.f0)(j.prototype,i.uS),(0,i.f0)(j.prototype,F),j.prototype._recompute=function(t,e){(t.media||t.index)&&this._differs(e.mediaItem,e.mediaItem=function({media:t,index:e}){return(0,l.U2)(t,[e])}(e))&&(t.mediaItem=!0),t.mediaItem&&(this._differs(e.focusX,e.focusX=function({mediaItem:t}){return(0,l.U2)(t,["focusX"],0)}(e))&&(t.focusX=!0),this._differs(e.focusY,e.focusY=function({mediaItem:t}){return(0,l.U2)(t,["focusY"],0)}(e))&&(t.focusY=!0),this._differs(e.previewSrc,e.previewSrc=function({mediaItem:t}){return t.data.preview_url}(e))&&(t.previewSrc=!0),this._differs(e.nativeWidth,e.nativeWidth=function({mediaItem:t}){return(0,l.U2)(t,["data","meta","original","width"],300)}(e))&&(t.nativeWidth=!0),this._differs(e.nativeHeight,e.nativeHeight=function({mediaItem:t}){return(0,l.U2)(t,["data","meta","original","height"],200)}(e))&&(t.nativeHeight=!0),this._differs(e.shortName,e.shortName=function({mediaItem:t}){return(0,l.U2)(t,["file","name"])||(0,l.U2)(t,["description"])||"media"}(e))&&(t.shortName=!0),this._differs(e.intrinsicWidth,e.intrinsicWidth=function({mediaItem:t}){return(0,l.U2)(t,["data","meta","original","width"])}(e))&&(t.intrinsicWidth=!0),this._differs(e.intrinsicHeight,e.intrinsicHeight=function({mediaItem:t}){return(0,l.U2)(t,["data","meta","original","height"])}(e))&&(t.intrinsicHeight=!0)),(t.nativeWidth||t.nativeHeight||t.containerWidth||t.containerHeight)&&this._differs(e.scale,e.scale=function({nativeWidth:t,nativeHeight:e,containerWidth:a,containerHeight:i}){return(0,g.y)(a,i,t,e)}(e))&&(t.scale=!0),t.scale&&(this._differs(e.scaleWidth,e.scaleWidth=function({scale:t}){return t.width}(e))&&(t.scaleWidth=!0),this._differs(e.scaleHeight,e.scaleHeight=function({scale:t}){return t.height}(e))&&(t.scaleHeight=!0),this._differs(e.scaleX,e.scaleX=function({scale:t}){return t.x}(e))&&(t.scaleX=!0),this._differs(e.scaleY,e.scaleY=function({scale:t}){return t.y}(e))&&(t.scaleY=!0)),t.focusX&&this._differs(e.indicatorX,e.indicatorX=function({focusX:t}){return(0,h.i)(t)/100}(e))&&(t.indicatorX=!0),t.focusY&&this._differs(e.indicatorY,e.indicatorY=function({focusY:t}){return(100-(0,h.i)(t))/100}(e))&&(t.indicatorY=!0),(t.scaleWidth||t.scaleHeight||t.scaleX||t.scaleY)&&this._differs(e.draggableAreaStyle,e.draggableAreaStyle=function({scaleWidth:t,scaleHeight:e,scaleX:a,scaleY:i}){return`top: ${i}px; left: ${a}px; width: ${t}px; height: ${e}px;`}(e))&&(t.draggableAreaStyle=!0)};const k=j;var D=a(8183),P=a(4831),M=a(689),B=a(8044),q=a(9260),W=a(641);const U=()=>a.e(5403).then(a.bind(a,5403)).then((t=>t.default)),V=3e5;let Z,O;const J=[{status:"loading tesseract core",proportion:.1},{status:"initializing tesseract",proportion:.05},{status:"loading language traineddata",proportion:.1},{status:"initializing api",proportion:.2},{status:"recognizing text",proportion:.55}];async function G(t,e){const a=e=>{const{data:a}=e;t&&"progress"===a.status&&J.find((({status:t})=>t===a.data.status))&&t(function(t){const e=J.findIndex((({status:e})=>t.status===e));let a=0;for(let i=0;i<e;i++)a+=J[i].proportion;return a+=J[e].proportion*t.progress,a}(a.data))};Z.worker.addEventListener("message",a);try{return await e()}finally{Z.worker.removeEventListener("message",a)}}function K(){Z&&(Z.terminate(),Z=null)}function Q(){O&&(clearTimeout(O),O=null)}async function tt(t,e){Q(),await async function(t){Z||(Z=await(await U())(),await G(t,(async()=>{await Z.loadLanguage("eng"),await Z.initialize("eng")})))}(e);try{const a=await async function(t,e){return G(e,(()=>Z.recognize(t,"eng")))}(t,e);return a.data.text}finally{Q(),O=setTimeout(K,V)}}var et=a(7031),at=a(6633),it=a(1162);const rt=(0,p.g)(R.b);var st={observe:c.N7,setupSyncFromStore(){this.observe("media",(t=>{t=t||[];const{index:e,rawText:a}=this.get(),i=(0,l.U2)(t,[e,"description"],"");a!==i&&this.set({rawText:i})}))},setupSyncToStore(){this.observe("rawText",(t=>{rt((()=>{const{realm:e,index:a,media:i}=this.get();i[a].description!==t&&(i[a].description=t,this.store.setComposeData(e,{media:i}),this.store.save()),this.fire("resize")}))}),{init:!1})},setupAutosize(){const t=this.refs.textarea;(0,R.b)((()=>{(0,D.B)("autosize()"),(0,P.i)(t),(0,D.s)("autosize()")}))},teardownAutosize(){(0,D.B)("autosize.destroy()"),P.i.destroy(this.refs.textarea),(0,D.s)("autosize.destroy()")},measure(){P.i.update(this.refs.textarea)},async onClick(){this.set({extracting:!0});try{const{url:t,mediaId:e}=this.get(),a=t=>{requestAnimationFrame((()=>{this.set({extractionProgress:100*t})}))},i=await it.F.getCachedMediaFile(e);let r;if(i){const t=URL.createObjectURL(i);try{r=await tt(t,a)}finally{URL.revokeObjectURL(t)}}else r=await tt(t,a);const{media:s,index:n,realm:o}=this.get();s[n].description!==r&&(s[n].description=r,this.store.setComposeData(o,{media:s}),this.store.save())}catch(t){console.error(t),et.A.say("Unable to extract text.")}finally{this.set({extracting:!1}),setTimeout((()=>{requestAnimationFrame((()=>{this.set({extractionProgress:0})}))}),400)}}};function nt(){this.setupAutosize(),this.setupSyncFromStore(),this.setupSyncToStore()}function ot(){this.teardownAutosize()}function dt(t){var e;if((0,i.S1)(this,t),this.store=d.h,this.refs={},this._state=(0,i.f0)({rawText:"",mediaAltCharLimit:M.Y3,extracting:!1,className:"",extractionProgress:0},t.data),this._recompute({rawText:1,mediaAltCharLimit:1,length:1,media:1,index:1,extracting:1,extractButtonText:1,extractionProgress:1},this._state),this._intro=!0,this._handlers.destroy=[ot],document.getElementById("svelte-1brgwox-style")||((e=(0,i.az)("style")).id="svelte-1brgwox-style",e.textContent=".media-alt-editor.svelte-1brgwox{display:flex;flex-direction:column}.media-alt-input.svelte-1brgwox{padding:5px;border:1px solid var(--input-border);min-height:40px;resize:none;overflow:hidden;word-wrap:break-word;font-size:1.2em;max-height:70vh}.extract-text-button.svelte-1brgwox{display:flex;justify-content:center;align-items:center;margin-top:10px}.extract-text-button.svelte-1brgwox span.svelte-1brgwox{margin-left:15px}.extract-text-svg{fill:var(--button-text);width:18px;height:18px}@media(max-height: 767px){.media-alt-input.svelte-1brgwox{max-height:40vh;width:100%;overflow:auto}.extract-text-button.svelte-1brgwox{margin-top:0}button.extract-text-button.svelte-1brgwox{padding:7px 10px}}@media(min-height: 768px){.media-alt-input.svelte-1brgwox{min-width:250px;min-height:75px}}",(0,i.R3)(document.head,e)),this._fragment=function(t,e){var a,r,s,n,o,d,l,c,m,h,g,u,p,x,v,y,b=!1;function w(){b=!0,t.set({rawText:r.value}),b=!1}var _={length:e.length,overLimit:e.overLimit,max:e.mediaAltCharLimit},I=new B.Z({root:t.root,store:t.store,data:_}),R={length:e.length,overLimit:e.overLimit,max:e.mediaAltCharLimit,style:"width: 100%; text-align: right;"},N=new q.Z({root:t.root,store:t.store,data:R}),E={href:e.extracting?"#fa-spinner":"#fa-magic",className:"extract-text-svg "+(e.extracting?"spin":"")},L=new f.Z({root:t.root,store:t.store,data:E});function C(e){t.onClick()}var S={length:e.extractionProgress,overLimit:!1,max:100},$=new B.Z({root:t.root,store:t.store,data:S});return{c(){a=(0,i.az)("div"),r=(0,i.az)("textarea"),n=(0,i.rw)("\n  "),o=(0,i.az)("label"),d=(0,i.rw)("Describe for visually impaired people"),c=(0,i.rw)("\n  "),I._fragment.c(),m=(0,i.rw)("\n  "),N._fragment.c(),h=(0,i.rw)("\n  "),g=(0,i.az)("button"),L._fragment.c(),u=(0,i.rw)("\n    "),p=(0,i.az)("span"),x=(0,i.rw)(e.extractButtonText),v=(0,i.rw)("\n  "),$._fragment.c(),this.h()},l(t){a=(0,i.d$)(t,"DIV",{class:!0},!1);var s=(0,i.pI)(a);r=(0,i.d$)(s,"TEXTAREA",{id:!0,class:!0,placeholder:!0},!1),(0,i.pI)(r).forEach(i.r2),n=(0,i.M4)(s,"\n  "),o=(0,i.d$)(s,"LABEL",{for:!0,class:!0},!1);var l=(0,i.pI)(o);d=(0,i.M4)(l,"Describe for visually impaired people"),l.forEach(i.r2),c=(0,i.M4)(s,"\n  "),I._fragment.l(s),m=(0,i.M4)(s,"\n  "),N._fragment.l(s),h=(0,i.M4)(s,"\n  "),g=(0,i.d$)(s,"BUTTON",{class:!0,type:!0,disabled:!0,"aria-label":!0},!1);var f=(0,i.pI)(g);L._fragment.l(f),u=(0,i.M4)(f,"\n    "),p=(0,i.d$)(f,"SPAN",{class:!0},!1);var y=(0,i.pI)(p);x=(0,i.M4)(y,e.extractButtonText),y.forEach(i.r2),f.forEach(i.r2),v=(0,i.M4)(s,"\n  "),$._fragment.l(s),s.forEach(i.r2),this.h()},h(){(0,i.NH)(r,"input",w),r.id=s="the-media-alt-input-"+e.realm+"-"+e.index,r.className="media-alt-input svelte-1brgwox",r.placeholder="Describe for visually impaired people",o.htmlFor=l="the-media-alt-input-"+e.realm+"-"+e.index,o.className="sr-only",p.className="svelte-1brgwox",(0,i.NH)(g,"click",C),g.className="extract-text-button svelte-1brgwox",g.type="button",g.disabled=e.extracting,(0,i.P$)(g,"aria-label",e.extractButtonLabel),a.className=y="media-alt-editor "+e.className+" svelte-1brgwox"},m(s,l){(0,i.$T)(s,a,l),(0,i.R3)(a,r),t.refs.textarea=r,r.value=e.rawText,(0,i.R3)(a,n),(0,i.R3)(a,o),(0,i.R3)(o,d),(0,i.R3)(a,c),I._mount(a,null),(0,i.R3)(a,m),N._mount(a,null),(0,i.R3)(a,h),(0,i.R3)(a,g),L._mount(g,null),(0,i.R3)(g,u),(0,i.R3)(g,p),(0,i.R3)(p,x),(0,i.R3)(a,v),$._mount(a,null)},p(t,e){!b&&t.rawText&&(r.value=e.rawText),(t.realm||t.index)&&s!==(s="the-media-alt-input-"+e.realm+"-"+e.index)&&(r.id=s),(t.realm||t.index)&&l!==(l="the-media-alt-input-"+e.realm+"-"+e.index)&&(o.htmlFor=l);var n={};t.length&&(n.length=e.length),t.overLimit&&(n.overLimit=e.overLimit),t.mediaAltCharLimit&&(n.max=e.mediaAltCharLimit),I._set(n);var d={};t.length&&(d.length=e.length),t.overLimit&&(d.overLimit=e.overLimit),t.mediaAltCharLimit&&(d.max=e.mediaAltCharLimit),N._set(d);var c={};t.extracting&&(c.href=e.extracting?"#fa-spinner":"#fa-magic"),t.extracting&&(c.className="extract-text-svg "+(e.extracting?"spin":"")),L._set(c),t.extractButtonText&&(0,i.a_)(x,e.extractButtonText),t.extracting&&(g.disabled=e.extracting),t.extractButtonLabel&&(0,i.P$)(g,"aria-label",e.extractButtonLabel);var m={};t.extractionProgress&&(m.length=e.extractionProgress),$._set(m),t.className&&y!==(y="media-alt-editor "+e.className+" svelte-1brgwox")&&(a.className=y)},d(e){e&&(0,i.r2)(a),(0,i.ys)(r,"input",w),t.refs.textarea===r&&(t.refs.textarea=null),I.destroy(),N.destroy(),L.destroy(),(0,i.ys)(g,"click",C),$.destroy()}}}(this,this._state),this.root._oncreate.push((()=>{nt.call(this),this.fire("update",{changed:(0,i.lZ)({},this._state),current:this._state})})),t.target){var a=(0,i.pI)(t.target);t.hydrate?this._fragment.l(a):this._fragment.c(),a.forEach(i.r2),this._mount(t.target,t.anchor),(0,i.yl)(this)}}(0,i.f0)(dt.prototype,i.uS),(0,i.f0)(dt.prototype,st),dt.prototype._recompute=function(t,e){t.rawText&&this._differs(e.length,e.length=function({rawText:t}){return(0,W.length)(t||"")}(e))&&(t.length=!0),(t.mediaAltCharLimit||t.length)&&this._differs(e.overLimit,e.overLimit=function({mediaAltCharLimit:t,length:e}){return e>t}(e))&&(t.overLimit=!0),(t.media||t.index)&&(this._differs(e.url,e.url=function({media:t,index:e}){return(0,l.U2)(t,[e,"data","url"])}(e))&&(t.url=!0),this._differs(e.mediaId,e.mediaId=function({media:t,index:e}){return(0,l.U2)(t,[e,"data","id"])}(e))&&(t.mediaId=!0)),t.extracting&&this._differs(e.extractButtonText,e.extractButtonText=function({extracting:t}){return t?"Extracting text…":"Extract text from image"}(e))&&(t.extractButtonText=!0),(t.extractButtonText||t.extractionProgress||t.extracting)&&this._differs(e.extractButtonLabel,e.extractButtonLabel=function({extractButtonText:t,extractionProgress:e,extracting:a}){return a?(0,at.A)(["Extracting text (",["percent"],"% complete)…"],{percent:Math.round(e)}):t}(e))&&(t.extractButtonLabel=!0)};const lt=dt;var ct={show:s.$,close:n.x,measure(){this.refs.altEditor.measure(),this.refs.focalPointEditor&&this.refs.focalPointEditor.measure()}};function mt(t,e){var a,r,s,n,o={className:"media-edit-item",realm:e.realm,index:e.index,media:e.media},d=new k({root:t.root,store:t.store,data:o});return t.refs.focalPointEditor=d,{c(){a=(0,i.az)("div"),r=(0,i.az)("h2"),s=(0,i.rw)("Preview (focal point)"),n=(0,i.rw)("\n        "),d._fragment.c(),this.h()},l(t){a=(0,i.d$)(t,"DIV",{class:!0},!1);var e=(0,i.pI)(a);r=(0,i.d$)(e,"H2",{class:!0},!1);var o=(0,i.pI)(r);s=(0,i.M4)(o,"Preview (focal point)"),o.forEach(i.r2),n=(0,i.M4)(e,"\n        "),d._fragment.l(e),e.forEach(i.r2),this.h()},h(){r.className="svelte-da81m7",a.className="media-edit-header-and-item media-edit-header-and-item-focal svelte-da81m7"},m(t,e){(0,i.$T)(t,a,e),(0,i.R3)(a,r),(0,i.R3)(r,s),(0,i.R3)(a,n),d._mount(a,null)},p(t,e){var a={};t.realm&&(a.realm=e.realm),t.index&&(a.index=e.index),t.media&&(a.media=e.media),d._set(a)},d(e){e&&(0,i.r2)(a),d.destroy(),t.refs.focalPointEditor===d&&(t.refs.focalPointEditor=null)}}}function ht(t){var e;if((0,i.S1)(this,t),this.store=d.h,this.refs={},this._state=(0,i.f0)(this.store._init(["currentInstance","composeData"]),t.data),this.store._add(this,["currentInstance","composeData"]),this._recompute({$currentInstance:1,$composeData:1,realm:1},this._state),this._intro=!0,this._handlers.destroy=[i.iT],document.getElementById("svelte-da81m7-style")||((e=(0,i.az)("style")).id="svelte-da81m7-style",e.textContent=".media-edit-dialog{max-width:calc(100%)}.media-edit-dialog-container.svelte-da81m7{display:flex;flex-direction:row;max-height:calc(100% - 44px);height:100%;width:100%}.media-edit-header-and-item.svelte-da81m7{padding:10px}.media-edit-header-and-item.svelte-da81m7 h2.svelte-da81m7{margin-bottom:10px}@media(max-width: 767px){.media-edit-dialog-container.svelte-da81m7{flex-direction:column;overflow:hidden}.media-edit-dialog-container.svelte-da81m7{max-height:calc(100% - 25px)}.media-edit-header-and-item.svelte-da81m7{flex:1;min-height:0;padding:5px 10px}.media-edit-header-and-item.svelte-da81m7{display:flex;flex-direction:column}.media-edit-item{flex:1;min-height:0}.media-edit-header-and-item-alt.svelte-da81m7{flex-basis:40%}.media-edit-header-and-item-focal.svelte-da81m7{flex-basis:60%}.media-edit-header-and-item.svelte-da81m7 h2.svelte-da81m7{font-size:1.2em;margin-bottom:5px}}",(0,i.R3)(document.head,e)),this._fragment=function(t,e){var a,s,n,o,d,l,c={className:"media-edit-item",realm:e.realm,index:e.index,media:e.media},m=new lt({root:t.root,store:t.store,data:c});m.on("resize",(function(e){t.measure()})),t.refs.altEditor=m;var h=("image"===e.type||"gifv"===e.type)&&mt(t,e),f={id:e.id,label:e.label,title:e.title,background:"var(--main-bg)",className:"media-edit-dialog"},g=new r.Z({root:t.root,store:t.store,slots:{default:(0,i.xJ)()},data:f});return g.on("show",(function(e){t.measure()})),{c(){a=(0,i.az)("div"),s=(0,i.az)("div"),n=(0,i.az)("h2"),o=(0,i.rw)("Description"),d=(0,i.rw)("\n      "),m._fragment.c(),l=(0,i.rw)("\n    "),h&&h.c(),g._fragment.c(),this.h()},l(t){a=(0,i.d$)(t,"DIV",{class:!0},!1);var e=(0,i.pI)(a);s=(0,i.d$)(e,"DIV",{class:!0},!1);var r=(0,i.pI)(s);n=(0,i.d$)(r,"H2",{class:!0},!1);var c=(0,i.pI)(n);o=(0,i.M4)(c,"Description"),c.forEach(i.r2),d=(0,i.M4)(r,"\n      "),m._fragment.l(r),r.forEach(i.r2),l=(0,i.M4)(e,"\n    "),h&&h.l(e),e.forEach(i.r2),g._fragment.l(t),this.h()},h(){n.className="svelte-da81m7",s.className="media-edit-header-and-item media-edit-header-and-item-alt svelte-da81m7",a.className="media-edit-dialog-container svelte-da81m7"},m(t,e){(0,i.R3)(g._slotted.default,a),(0,i.R3)(a,s),(0,i.R3)(s,n),(0,i.R3)(n,o),(0,i.R3)(s,d),m._mount(s,null),(0,i.R3)(a,l),h&&h.m(a,null),g._mount(t,e)},p(e,i){var r={};e.realm&&(r.realm=i.realm),e.index&&(r.index=i.index),e.media&&(r.media=i.media),m._set(r),"image"===i.type||"gifv"===i.type?h?h.p(e,i):((h=mt(t,i)).c(),h.m(a,null)):h&&(h.d(1),h=null);var s={};e.id&&(s.id=i.id),e.label&&(s.label=i.label),e.title&&(s.title=i.title),g._set(s)},d(e){m.destroy(),t.refs.altEditor===m&&(t.refs.altEditor=null),h&&h.d(),g.destroy(e)}}}(this,this._state),this.root._oncreate.push((()=>{o.U.call(this),this.fire("update",{changed:(0,i.lZ)({},this._state),current:this._state})})),t.target){var a=(0,i.pI)(t.target);t.hydrate?this._fragment.l(a):this._fragment.c(),a.forEach(i.r2),this._mount(t.target,t.anchor),(0,i.yl)(this)}}(0,i.f0)(ht.prototype,i.uS),(0,i.f0)(ht.prototype,ct),ht.prototype._recompute=function(t,e){(t.$currentInstance||t.$composeData||t.realm)&&this._differs(e.media,e.media=function({$currentInstance:t,$composeData:e,realm:a}){return(0,l.U2)(e,[t,a,"media"])}(e))&&(t.media=!0)};const ft=ht;var gt=a(3634);function ut(t,e,a){return(0,gt.v)(ft,{label:"Edit media",title:"Edit media",realm:t,index:e,type:a})}},7687:(t,e,a)=>{a.d(e,{y:()=>i});const i=(t,e,a,i)=>{const r=a/i;let s=t,n=e;return r>t/e?n=s/r:s=n*r,{width:s,height:n,x:(t-s)/2,y:(e-n)/2}}}}]);
//# sourceMappingURL=135.ff9fb83befb26b5ed616.135.js.map