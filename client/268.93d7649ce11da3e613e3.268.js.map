{"version":3,"file":"268.93d7649ce11da3e613e3.268.js","mappings":"oNAkLa,CACPA,KAAI,IACJC,MAAK,IACL,oBAAAC,CAAsBC,GACpBC,KAAKC,mCACX,EACI,cAAAC,CAAgBH,GAEpB,EACI,eAAAI,CAAiBJ,GACfC,KAAKC,mCACX,EACI,UAAMG,GACJ,MAAMC,EAASL,KAAKM,mBACd,aAAEC,GAAiBP,KAAKQ,YACxB,QAAqBD,EAAcF,EAC/C,EACI,iCAAAJ,GACE,MAAMQ,IAA+BT,KAAKU,KAAKC,UAAUC,MAAMC,QAAQ,OAAQ,KAC7E,IAAIb,KAAKU,KAAKI,kBAAkBC,iBAAiB,UAAUC,MAAKC,GAAYA,EAASC,WACvFlB,KAAKmB,IAAI,CAAEV,8BACjB,EACI,eAAAW,CAAiBf,GACVA,IACHA,EAAS,CACPgB,OAAQ,GACRC,WAAY,KACZC,QAAS,IAAI,MACbC,cAAc,EACdC,YAAY,IAIhBzB,KAAKU,KAAKC,UAAUC,MAAQP,EAAOgB,OAEnC,IAAIK,EAAiB,EACrB,GAAIrB,EAAOiB,WAAY,CACrB,MAAMK,EAAMC,KAAKD,MACjBD,EAAiB,KAA2BrB,QAAOwB,GAAKA,EAAEjB,QACvDkB,MAAK,CAACC,EAAGC,KAER,MAAMC,EAAgBN,EAAiB,IAAVI,EAAEnB,MACzBsB,EAAgBP,EAAiB,IAAVK,EAAEpB,MAG/B,OAFeuB,KAAKC,IAAI,IAAIR,KAAKvB,EAAOiB,YAAYe,UAAYJ,GACjDE,KAAKC,IAAI,IAAIR,KAAKvB,EAAOiB,YAAYe,UAAYH,IACtC,EAAI,KAC7B,GAAGtB,KACd,CAEIZ,KAAKU,KAAK4B,oBAAoBC,cAAc,UAAU3B,MAAQc,EAC9D,IAAK,MAAMT,IAAY,IAAIjB,KAAKU,KAAKI,kBAAkBC,iBAAiB,UACtEE,EAASC,QAAUb,EAAOkB,QAAQiB,SAASvB,EAASL,OAEtDZ,KAAKU,KAAK+B,qBAAqBvB,UAAYb,EAAOmB,aAClDxB,KAAKU,KAAKgC,kBAAkBxB,UAAYb,EAAOoB,UACrD,EACI,eAAAnB,GACE,MAAMqC,EAAiB3C,KAAKQ,MAAMH,OAC5BA,EAAS,CACbuC,GAAID,GAAkBA,EAAeC,IAEvCvC,EAAOgB,OAASrB,KAAKU,KAAKC,UAAUC,MACpC,MAAMiC,EAAS7C,KAAKU,KAAK4B,oBAAoBC,cAAc,UACrDO,EAAcC,SAASF,EAAOjC,MAAO,IAW3C,OAPAP,EAAO2C,WAAaF,GAAe,KACnCzC,EAAOkB,QAAU,IAAIvB,KAAKU,KAAKI,kBAAkBC,iBAAiB,UAC/DV,QAAO4C,GAASA,EAAM/B,UACtBgC,KAAID,GAASA,EAAMrC,QACtBP,EAAOmB,aAAexB,KAAKU,KAAK+B,qBAAqBvB,QACrDb,EAAOoB,WAAazB,KAAKU,KAAKgC,kBAAkBxB,QAEzCb,CACb,G,mBA9GI8C,EAAA,EAAeC,KAAKpD,MACpBA,KAAKoB,gBAAgBpB,KAAKQ,MAAMH,QAChCL,KAAKC,mCACX,C,gDAvG4BE,gBAAgBJ,E,oGAEyB,I,IAAbwB,QAAQ8B,M,4fAHxC9B,QAAQX,M,4BAEMW,QAAQX,M,iCACPW,QAAQX,K,oHAHvBW,QAAQX,S,yDAEMW,QAAQX,S,mCACUW,QAAQ8B,S,2DAAzB9B,QAAQX,S,8GAsG9B0C,EAAA,E,kCACA,CACXjD,YAAQkD,EACRhD,kBAAcgD,EACdC,aAAc,OACdC,cAAe,KACfC,mBAAoB,KACpBC,eAAgB,CACd,CACEN,MAAO,iBACPzC,MAAO,MAET,CACEyC,MAAO,gBACPzC,MAAO,MAET,CACEyC,MAAO,mBACPzC,MAAO,MAET,CACEyC,MAAO,gBACPzC,MAAO,MAET,CACEyC,MAAO,WACPzC,MAAO,OAGXH,4BAA4B,G,o6CA9JXX,qBAAqBC,E,wDAQrB0D,c,eACKC,mB,iGACHxD,eAAeH,E,gBAUzB4D,e,aAAL,Y,+BArCPf,G,QACAS,M,QACAO,M,eACAJ,a,6BACA/C,4B,+GACYL,M,8vJAoBQqD,e,wCACKC,oB,gCAWbC,e,gBAAL,a,kHAAA,M,wBArCPf,I,oBACAS,O,oBACAO,O,kCACAJ,c,8DACA/C,4B,0uBCFY,SAASoD,GAAkB,OAAExD,EAAM,aAAEE,IAClD,MAAM8C,EAAQhD,EAAS,cAAgB,aACvC,OAAO,OAAW,EAAkB,CAClCgD,QACAO,MAAOP,EACPhD,SACAE,gBAEJ,C,kGCXO,MAAMuD,EAA2B,OAC3BC,EAAoC,gBACpCC,EAA6B,SAC7BC,EAA6B,SAC7BC,EAA8B,UAE9BC,EAAuB,CAClCL,EACAC,EACAC,EACAC,EACAC,GAKWE,EAA6B,CACxC,CACExD,MAAO,EACPyC,MAAO,SAET,CACEzC,MAAO,KACPyC,MAAO,cAET,CACEzC,MAAO,KACPyC,MAAO,UAET,CACEzC,MAAO,MACPyC,MAAO,WAET,CACEzC,MAAO,MACPyC,MAAO,YAET,CACEzC,MAAO,MACPyC,MAAO,SAET,CACEzC,MAAO,OACPyC,MAAO,WAIEgB,EAA6B,C","sources":["webpack:///./src/routes/_components/dialog/components/WordFilterDialog.html","webpack:///./src/routes/_components/dialog/creators/showWordFilterDialog.js","webpack:///./src/routes/_static/wordFilters.js"],"sourcesContent":["<GenericConfirmationDialog\n  {id}\n  {label}\n  {title}\n  {positiveText}\n  {confirmationButtonDisabled}\n  on:positive=\"save()\">\n  <div class=\"word-filter-dialog\">\n    <div class=\"word-filter-keyword\">\n      <label for=\"word-filter-word-or-phrase\" class=\"word-filter-keyword-label\">\n        <span>Word or phrase</span>\n        <!-- no need for aria-label=\"Required\", the input is already marked as required -->\n        <span aria-hidden=\"true\" class=\"required\">*</span>\n      </label>\n      <input type=\"text\"\n             required\n             autocomplete=\"off\"\n             autocapitalize=\"off\"\n             on:input=\"onWordOrPhraseChange(event)\"\n             ref:wordInput\n             id=\"word-filter-word-or-phrase\"\n      >\n    </div>\n    <div class=\"word-filter-expire-after\" ref:expireSelectWrapper>\n      <span class=\"word-filter-label-like word-filter-expire-label\">Expire after</span>\n      <Select className=\"word-filter-expiry-select\"\n              options={expiryOptions}\n              defaultValue={expiryDefaultValue}\n              on:change=\"onExpiryChange(event)\"\n              label=\"Expire after\"\n      />\n    </div>\n    <div class=\"word-filter-where-to-filter\">\n      <span class=\"word-filter-label-like\" id=\"word-filter-where-to-filter-label\">\n        <span>Where to filter</span>\n        <span aria-label=\"Required\" class=\"required\">*</span>\n      </span>\n      <ul class=\"word-filter-radio-list\" aria-describedby=\"word-filter-where-to-filter-label\" ref:contextCheckboxes>\n        {#each filterContexts as context}\n        <li>\n          <input type=\"checkbox\"\n                 name=\"where-to-filter\"\n                 value={context.value}\n                 on:change=\"onContextChange(event)\"\n                 id=\"where-to-filter-{context.value}\">\n          <label for=\"where-to-filter-{context.value}\">{context.label}</label>\n        </li>\n        {/each}\n      </ul>\n    </div>\n    <div class=\"word-filter-irreversible\">\n      <input type=\"checkbox\"\n             name=\"irreversible\"\n             ref:irreversibleCheckbox\n             id=\"word-filter-irreversible\">\n      <label for=\"word-filter-irreversible\">Irreversible</label>\n    </div>\n    <div class=\"word-filter-whole\">\n      <input type=\"checkbox\"\n             name=\"irreversible\"\n             ref:wholeWordCheckbox\n             id=\"word-filter-whole\">\n      <label for=\"word-filter-whole\">Whole word</label>\n    </div>\n  </div>\n</GenericConfirmationDialog>\n<style>\n.word-filter-dialog {\n  padding: 20px 40px;\n  overflow-y: auto;\n  display: grid;\n  grid-template-areas: \"keyword      expire\"\n                       \"context      context\"\n                       \"irreversible whole\";\n  grid-row-gap: 20px;\n  grid-column-gap: 10px;\n}\n.word-filter-label-like {\n  font-size: 1.3em;\n}\n.word-filter-radio-list {\n  list-style: none;\n  margin-top: 5px;\n}\n.word-filter-keyword {\n  grid-area: keyword;\n}\n.word-filter-expire-after {\n  grid-area: expire;\n}\n.word-filter-where-to-filter {\n  grid-area: context;\n}\n.word-filter-irreversible {\n  grid-area: irreversible;\n}\n.word-filter-whole {\n  grid-area: whole;\n}\n.word-filter-keyword-label, .word-filter-expire-label {\n  margin-right: 10px;\n}\n.required {\n  color: var(--warn-color);\n}\n@media (max-width: 479px) {\n  .word-filter-dialog {\n    grid-template-areas: \"keyword\"\n                         \"expire\"\n                         \"context\"\n                         \"irreversible\"\n                         \"whole\";\n    grid-column-gap: 5px;\n    grid-row-gap: 10px;\n  }\n}\n@media (max-width: 320px) {\n  .word-filter-dialog {\n    grid-row-gap: 5px;\n  }\n}\n</style>\n<script>\n  import GenericConfirmationDialog from './GenericConfirmationDialog.html'\n  import Select from '../../Select.html'\n  import { show } from '../helpers/showDialog.js'\n  import { close } from '../helpers/closeDialog.js'\n  import { oncreate as onCreateDialog } from '../helpers/onCreateDialog.js'\n  import { store } from '../../../_store/store.js'\n  import {\n    WORD_FILTER_CONTEXT_ACCOUNT,\n    WORD_FILTER_CONTEXT_HOME,\n    WORD_FILTER_CONTEXT_NOTIFICATIONS,\n    WORD_FILTER_CONTEXT_PUBLIC,\n    WORD_FILTER_CONTEXT_THREAD,\n    WORD_FILTER_CONTEXTS,\n    WORD_FILTER_EXPIRY_DEFAULT,\n    WORD_FILTER_EXPIRY_OPTIONS\n  } from '../../../_static/wordFilters.js'\n  import { createOrUpdateFilter } from '../../../_actions/filters.js'\n\n  export default {\n    async oncreate () {\n      onCreateDialog.call(this)\n      this.syncFilterToDom(this.get().filter)\n      this.computeConfirmationButtonDisabled()\n    },\n    store: () => store,\n    data: () => ({\n      filter: undefined,\n      instanceName: undefined,\n      positiveText: \"Save\",\n      expiryOptions: WORD_FILTER_EXPIRY_OPTIONS,\n      expiryDefaultValue: WORD_FILTER_EXPIRY_DEFAULT,\n      filterContexts: [\n        {\n          label: \"Home and lists\",\n          value: WORD_FILTER_CONTEXT_HOME\n        },\n        {\n          label: \"Notifications\",\n          value: WORD_FILTER_CONTEXT_NOTIFICATIONS\n        },\n        {\n          label: \"Public timelines\",\n          value: WORD_FILTER_CONTEXT_PUBLIC\n        },\n        {\n          label: \"Conversations\",\n          value: WORD_FILTER_CONTEXT_THREAD\n        },\n        {\n          label: \"Profiles\",\n          value: WORD_FILTER_CONTEXT_ACCOUNT\n        }\n      ],\n      confirmationButtonDisabled: false\n    }),\n    methods: {\n      show,\n      close,\n      onWordOrPhraseChange (event) {\n        this.computeConfirmationButtonDisabled()\n      },\n      onExpiryChange (event) {\n\n      },\n      onContextChange (event) {\n        this.computeConfirmationButtonDisabled()\n      },\n      async save () {\n        const filter = this.syncDomToFilter()\n        const { instanceName } = this.get()\n        await createOrUpdateFilter(instanceName, filter)\n      },\n      computeConfirmationButtonDisabled () {\n        const confirmationButtonDisabled = !(this.refs.wordInput.value.replace(/\\s+/g, '') &&\n          [...this.refs.contextCheckboxes.querySelectorAll('input')].some(checkbox => checkbox.checked))\n        this.set({ confirmationButtonDisabled })\n      },\n      syncFilterToDom (filter) {\n        if (!filter) {\n          filter = {\n            phrase: '',\n            expires_at: WORD_FILTER_EXPIRY_DEFAULT,\n            context: [...WORD_FILTER_CONTEXTS],\n            irreversible: false,\n            whole_word: true\n          }\n        }\n\n        this.refs.wordInput.value = filter.phrase\n\n        let expiresAtValue = 0\n        if (filter.expires_at) {\n          const now = Date.now()\n          expiresAtValue = WORD_FILTER_EXPIRY_OPTIONS.filter(_ => _.value)\n            .sort((a, b) => {\n              // expires_at is an absolute timestamp, so sort by whichever one is closest given the current datetime\n              const aAbsoluteTime = now + (a.value * 1000)\n              const bAbsoluteTime = now + (b.value * 1000)\n              const aDelta = Math.abs(new Date(filter.expires_at).getTime() - aAbsoluteTime)\n              const bDelta = Math.abs(new Date(filter.expires_at).getTime() - bAbsoluteTime)\n              return aDelta < bDelta ? -1 : 1\n            })[0].value\n        }\n\n        this.refs.expireSelectWrapper.querySelector('select').value = expiresAtValue\n        for (const checkbox of [...this.refs.contextCheckboxes.querySelectorAll('input')]) {\n          checkbox.checked = filter.context.includes(checkbox.value)\n        }\n        this.refs.irreversibleCheckbox.checked = !!filter.irreversible\n        this.refs.wholeWordCheckbox.checked = !!filter.whole_word\n      },\n      syncDomToFilter () {\n        const existingFilter = this.get().filter\n        const filter = {\n          id: existingFilter && existingFilter.id\n        }\n        filter.phrase = this.refs.wordInput.value\n        const select = this.refs.expireSelectWrapper.querySelector('select')\n        const selectValue = parseInt(select.value, 10)\n        // When creating a new filter or updating a filter, `expires_in` is the number of seconds from now\n        // that the filter expires. When reading, it's `expires_at` which is a string ISO timestamp.\n        // Also, if you added a timeout for a filter, you can't change it to Never for some reason.\n        filter.expires_in = selectValue || null\n        filter.context = [...this.refs.contextCheckboxes.querySelectorAll('input')]\n          .filter(input => input.checked)\n          .map(input => input.value)\n        filter.irreversible = this.refs.irreversibleCheckbox.checked\n        filter.whole_word = this.refs.wholeWordCheckbox.checked\n\n        return filter\n      }\n    },\n    components: {\n      GenericConfirmationDialog,\n      Select\n    }\n  }\n</script>\n","import WordFilterDialog from '../components/WordFilterDialog.html'\nimport { showDialog } from './showDialog.js'\n\nexport default function showReportDialog ({ filter, instanceName }) {\n  const label = filter ? \"Edit filter\" : \"Add filter\"\n  return showDialog(WordFilterDialog, {\n    label,\n    title: label,\n    filter,\n    instanceName\n  })\n}\n","export const WORD_FILTER_CONTEXT_HOME = 'home'\nexport const WORD_FILTER_CONTEXT_NOTIFICATIONS = 'notifications'\nexport const WORD_FILTER_CONTEXT_PUBLIC = 'public'\nexport const WORD_FILTER_CONTEXT_THREAD = 'thread'\nexport const WORD_FILTER_CONTEXT_ACCOUNT = 'account'\n\nexport const WORD_FILTER_CONTEXTS = [\n  WORD_FILTER_CONTEXT_HOME,\n  WORD_FILTER_CONTEXT_NOTIFICATIONS,\n  WORD_FILTER_CONTEXT_PUBLIC,\n  WORD_FILTER_CONTEXT_THREAD,\n  WORD_FILTER_CONTEXT_ACCOUNT\n]\n\n// Someday we can maybe replace this with Intl.DurationFormat\n// https://github.com/tc39/proposal-intl-duration-format\nexport const WORD_FILTER_EXPIRY_OPTIONS = [\n  {\n    value: 0,\n    label: \"Never\"\n  },\n  {\n    value: 1800,\n    label: \"30 minutes\"\n  },\n  {\n    value: 3600,\n    label: \"1 hour\"\n  },\n  {\n    value: 21600,\n    label: \"6 hours\"\n  },\n  {\n    value: 43200,\n    label: \"12 hours\"\n  },\n  {\n    value: 86400,\n    label: \"1 day\"\n  },\n  {\n    value: 604800,\n    label: \"7 days\"\n  }\n]\n\nexport const WORD_FILTER_EXPIRY_DEFAULT = 0\n"],"names":["show","close","onWordOrPhraseChange","event","this","computeConfirmationButtonDisabled","onExpiryChange","onContextChange","save","filter","syncDomToFilter","instanceName","get","confirmationButtonDisabled","refs","wordInput","value","replace","contextCheckboxes","querySelectorAll","some","checkbox","checked","set","syncFilterToDom","phrase","expires_at","context","irreversible","whole_word","expiresAtValue","now","Date","_","sort","a","b","aAbsoluteTime","bAbsoluteTime","Math","abs","getTime","expireSelectWrapper","querySelector","includes","irreversibleCheckbox","wholeWordCheckbox","existingFilter","id","select","selectValue","parseInt","expires_in","input","map","onCreateDialog","call","label","store","undefined","positiveText","expiryOptions","expiryDefaultValue","filterContexts","title","showReportDialog","WORD_FILTER_CONTEXT_HOME","WORD_FILTER_CONTEXT_NOTIFICATIONS","WORD_FILTER_CONTEXT_PUBLIC","WORD_FILTER_CONTEXT_THREAD","WORD_FILTER_CONTEXT_ACCOUNT","WORD_FILTER_CONTEXTS","WORD_FILTER_EXPIRY_OPTIONS","WORD_FILTER_EXPIRY_DEFAULT"],"sourceRoot":""}