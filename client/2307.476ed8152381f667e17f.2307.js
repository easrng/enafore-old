"use strict";(this.webpackChunk=this.webpackChunk||[]).push([[2307],{2307:(e,n,t)=>{t.d(n,{Lr:()=>I,jh:()=>d,rd:()=>g,Q:()=>y,Ac:()=>m});var s=t(2625),a=t(5524),c=t(1169),o=t(7031),i=t(3999),r=t(1370),l=t(281),h=t(1162);const f=()=>Promise.all([t.e(4285),t.e(9225),t.e(4292)]).then(t.bind(t,9225));var u=t(6633);function I(e,n){const{instanceThemes:t}=a.h.get();t[e]=n,a.h.set({instanceThemes:t}),a.h.save();const{currentInstance:s}=a.h.get();if(e===s){const{enableGrayscale:e}=a.h.get();(0,c.Xi)(n,e)}}function g(e){const{instanceThemes:n}=a.h.get();a.h.set({currentInstance:e,searchResults:null,queryInSearch:""}),a.h.save();const{enableGrayscale:t}=a.h.get();(0,c.Xi)(n[e],t)}async function d(e,n){n=n||(0,u.A)(["Logged out of ",["instance"]],{instance:e});const{composeData:t,currentInstance:s,customEmoji:r,instanceInfos:l,instanceLists:I,instanceThemes:g,loggedInInstances:d,loggedInInstancesInOrder:m,verifyCredentials:y}=a.h.get();m.splice(m.indexOf(e),1);const w=e===s?m[0]:s,v=[t,r,l,I,g,d,y];for(const a of v)delete a[e];a.h.set({composeData:t,currentInstance:w,customEmoji:r,instanceInfos:l,instanceLists:I,instanceThemes:g,loggedInInstances:d,loggedInInstancesInOrder:m,queryInSearch:"",searchResults:null,timelineInitialized:!1,timelinePreinitialized:!1,verifyCredentials:y}),a.h.clearTimelineDataForInstance(e),a.h.clearAutosuggestDataForInstance(e),a.h.save();const{virtualListStore:p}=await f();p.clearRealmByPrefix(s+"/"),o.A.say(n);const{enableGrayscale:k}=a.h.get();(0,c.Xi)(g[w],k),h.F.clearDatabaseForInstance(e),(0,i.E9)("/settings/instances")}async function m(e){const{loggedInInstances:n}=a.h.get(),t=n[e].access_token;await(0,r.u)((()=>(0,s.Q)(e,t).catch(function(e){return async n=>{throw n.message.startsWith("401:")&&await d(e,(0,u.A)(["The access token was revoked, logged out of ",["instance"]],{instance:e})),n}}(e))),(()=>h.F.getInstanceVerifyCredentials(e)),(n=>h.F.setInstanceVerifyCredentials(e,n)),(n=>function(e,n){const{verifyCredentials:t}=a.h.get();t[e]=n,a.h.set({verifyCredentials:t})}(e,n)))}async function y(e){await(0,r.u)((()=>{const{loggedInInstances:n}=a.h.get(),t=n[e]&&n[e].access_token;return(0,l.s)(e,t)}),(()=>h.F.getInstanceInfo(e)),(n=>h.F.setInstanceInfo(e,n)),(n=>{const{instanceInfos:t}=a.h.get();t[e]=n,a.h.set({instanceInfos:t})}))}},281:(e,n,t)=>{t.d(n,{s:()=>c});var s=t(385),a=t(4886);async function c(e,n){const t=`${(0,a.E)(e)}/api/v1/instance`,c=n?(0,a.I)(n):null,o=await(0,s.U2)(t,c,{timeout:s.EH});o.nodeInfo=null;try{const n=await(0,s.U2)(`${(0,a.E)(e)}/.well-known/nodeinfo`,c,{timeout:s.EH});let t,i;for(const e of n.links)"http://nodeinfo.diaspora.software/ns/schema/2.1"===e.rel?t=e.href:"http://nodeinfo.diaspora.software/ns/schema/2.0"===e.rel&&(i=e.href);const r=await(0,s.U2)(t||i,{},{timeout:s.EH});o.nodeInfo=r}catch(i){console.warn("got error fetching nodeInfo",i)}return o}}}]);
//# sourceMappingURL=2307.476ed8152381f667e17f.2307.js.map