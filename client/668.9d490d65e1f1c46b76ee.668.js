"use strict";(this.webpackChunk=this.webpackChunk||[]).push([[668],{5041:(t,e,n)=>{n.d(e,{d:()=>u});var s=n(1162);var i=n(5524),o=n(4285),r=n(9970);function a(t,e,n){const s=t=>n(t.id);["timelineItemSummaries","timelineItemSummariesToAdd"].forEach((n=>{const r=i.h.getAllTimelineData(t,n);Object.keys(r).forEach((a=>{const c=r[a];if(!e(a))return;const l=c.filter(s);(0,o.Xy)(c,l)||i.h.setForTimeline(t,a,{[n]:l})}))}))}async function c(t,e,n){!function(t,e){const n=new Set(e);a(t,(t=>"notifications"!==t),(t=>!n.has(t)))}(t,e),function(t,e){const n=new Set(e);a(t,(t=>"notifications"===t),(t=>!n.has(t)))}(t,n),await s.F.deleteStatusesAndNotifications(t,e,n)}async function l(t,e){const n=await async function(t,e){return s.F.getReblogsForStatus(t,e)}(t,e),i=Array.from(new Set([e].concat(n).filter(Boolean))),o=Array.from(new Set(await async function(t,e){return s.F.getNotificationIdsForStatuses(t,e)}(t,i)));await c(t,i,o)}function u(t,e){(0,r.F)((()=>{l(t,e)}))}},4989:(t,e,n)=>{n.d(e,{Z:()=>c});var s=n(5524),i=n(1370),o=n(1162),r=n(2954),a=n(85);async function c(t){const{verifyCredentials:e,loggedInInstances:n}=s.h.get();if(!(0,a.U2)(e,[t,"locked"]))return;const c=n[t].access_token;await(0,i.u)((async()=>(await(0,r._v)(t,c)).length),(()=>o.F.getFollowRequestCount(t)),(e=>o.F.setFollowRequestCount(t,e)),(e=>{const{followRequestCounts:n}=s.h.get();n[t]=e,s.h.set({followRequestCounts:n})}))}},8131:(t,e,n)=>{n.d(e,{L:()=>u,R:()=>l});var s=n(5524),i=n(385),o=n(4886);var r=n(1370),a=n(1162);async function c(t,e){const{loggedInInstances:n}=s.h.get(),r=n[t].access_token;await e((()=>function(t,e){const n=`${(0,o.E)(t)}/api/v1/lists`;return(0,i.U2)(n,(0,o.I)(e),{timeout:i.EH})}(t,r)),(()=>a.F.getLists(t)),(e=>a.F.setLists(t,e)),(e=>{const{instanceLists:n}=s.h.get();n[t]=e,s.h.set({instanceLists:n})}))}async function l(t){await c(t,r.u)}async function u(t){await c(t,r.o)}},2954:(t,e,n)=>{n.d(e,{_v:()=>o});var s=n(385),i=n(4886);async function o(t,e,n=80){let o=`${(0,i.E)(t)}/api/v1/follow_requests`;return o+="?"+(0,s.pe)({limit:n}),(0,s.U2)(o,(0,i.I)(e),{timeout:s.EH})}},9076:(t,e,n)=>{n.d(e,{V:()=>o});var s=n(385),i=n(4886);async function o(t,e,n,o,r,a){const c=function(t){switch(t){case"local":case"federated":return"timelines/public";case"bubble":return"timelines/bubble";case"home":return"timelines/home";case"notifications":case"notifications/mentions":return"notifications";case"favorites":return"favourites";case"direct":return"conversations";case"bookmarks":return"bookmarks"}if(t.startsWith("tag/"))return"timelines/tag";if(t.startsWith("account/"))return"accounts";if(t.startsWith("list/"))return"timelines/list";throw new Error(`Invalid timeline type: ${t}`)}(n);let l=`${(0,i.E)(t)}/api/v1/${c}`;n.startsWith("tag/")?l+="/"+n.split("/")[1]:n.startsWith("account/")?l+="/"+n.split("/")[1]+"/statuses":n.startsWith("list/")&&(l+="/"+n.split("/")[1]);const u={};r&&(u.since_id=r),o&&(u.max_id=o),a&&(u.limit=a),"local"===n&&(u.local=!0),n.startsWith("account/")&&(n.endsWith("media")?u.only_media=!0:u.exclude_replies=!n.endsWith("/with_replies")),"notifications/mentions"===n&&(u.exclude_types=["follow","favourite","reblog","poll","admin.sign_up","update","follow_request","admin.report","reaction","pleroma:emoji_reaction"]),l+="?"+(0,s.pe)(u);let{json:h,headers:m}=await(0,s.SM)(l,(0,i.I)(e),{timeout:s.EH});return"direct"===n&&(h=h.map((t=>t.last_status)).filter(Boolean)),{items:h,headers:m}}},2625:(t,e,n)=>{n.d(e,{D:()=>r,Q:()=>o});var s=n(385),i=n(4886);function o(t,e){const n=`${(0,i.E)(t)}/api/v1/accounts/verify_credentials`;return(0,s.U2)(n,(0,i.I)(e),{timeout:s.EH})}function r(t,e,n){const o=`${(0,i.E)(t)}/api/v1/accounts/${n}`;return(0,s.U2)(o,(0,i.I)(e),{timeout:s.EH})}},7553:(t,e,n)=>{n.d(e,{B:()=>s});const s=()=>Promise.all([n.e(2936),n.e(2470),n.e(7539),n.e(5840),n.e(4285),n.e(7080),n.e(7323),n.e(1095),n.e(5482),n.e(8547)]).then(n.bind(n,5246)).then((t=>t.default))},370:(t,e,n)=>{n.d(e,{P:()=>i,f:()=>s});const s=432e6,i=3e5},9805:(t,e,n)=>{n.d(e,{Ay:()=>o,FO:()=>r,jN:()=>i});var s=n(7965);const i=`/emoji-${s.M}.json`,o=void 0,r="en-US"===s.M?"en":s.M},2650:(t,e,n)=>{n.d(e,{IO:()=>r,Ny:()=>s,_s:()=>u,aO:()=>a,j6:()=>c,lG:()=>l,wM:()=>o,zW:()=>i});const s="home",i="notifications",o="public",r="thread",a="account",c=[s,i,o,r,a],l=[{value:0,label:"Never"},{value:1800,label:"30 minutes"},{value:3600,label:"1 hour"},{value:21600,label:"6 hours"},{value:43200,label:"12 hours"},{value:86400,label:"1 day"},{value:604800,label:"7 days"}],u=0},3908:(t,e,n)=>{n.r(e);var s=n(85);function i(t){return t&&t[0]&&t[0].id}var o=n(8183);function r(t,e,n){t.compute(e,["currentInstance","currentTimeline",`timelineData_${e}`],((t,e,i)=>(0,s.U2)(i,[t,e],n)))}const a=2,c=new RegExp(`(?:\\s|^)((?:@|:|#)[\\w\\+_\\-:]{${a},})$`);function l(t,e,n){t.compute(e,["currentInstance","currentComposeRealm",`autosuggestData_${e}`],((t,e,i)=>(0,s.U2)(i,[t,e],n)))}var u=n(5524);const h=t=>new RegExp(t.map((t=>{let e=t.phrase.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return t.whole_word&&(/^[\w]/.test(e)&&(e=`\\b${e}`),/[\w]$/.test(e)&&(e=`${e}\\b`)),e})).join("|"),"i");var m=n(2650);var f=n(5061);const d=(t,e,n,s,i,o,r,a)=>c=>{if(c.filterContexts&&c.filterContexts.includes(a))return!1;switch(c.type){case"poll":return o;case"favourite":return s;case"reblog":return t;case"mention":return i;case"follow":return n;case"status":return r}return c.reblogId?t:!c.replyId||e};function g(t,e,n){t.compute(e,["currentInstance","instanceSettings","currentTimeline"],((t,e,i)=>{const o=n[i];return!o||(0,s.U2)(e,[t,o],!0)}))}function p(t,e,n){t.compute(e,["currentInstance","instanceSettings"],((t,e)=>(0,s.U2)(e,[t,n],!0)))}var w=n(2307),y=n(8131);class b{constructor(t){this.attempts=0,this.onReady=t}backoff(){const t=this.fibonacci(++this.attempts);setTimeout(this.onReady,t)}fibonacci(t){let e=1;if(t>e){let n=1;e=2;for(let s=2;s<t;s++){const t=n+e;n=e,e=t}}return Math.min(6e4,Math.floor(Math.random()*e*100))}reset(){this.attempts=0}}class S{constructor(t,e=[],n={}){this.url=t,this.protocols=e,this.reconnectEnabled=!0,this.listeners={},this.backoff=new b(this.onBackoffReady.bind(this)),(void 0===n.connect||n.connect)&&this.open()}open(t=!1){this.isReconnect=t;const e=this.ws&&this.ws.binaryType;this.ws=new WebSocket(this.url,this.protocols),this.ws.onclose=this.onCloseCallback.bind(this),this.ws.onerror=this.onErrorCallback.bind(this),this.ws.onmessage=this.onMessageCallback.bind(this),this.ws.onopen=this.onOpenCallback.bind(this),e&&(this.ws.binaryType=e)}onBackoffReady(){this.open(!0)}onCloseCallback(t){!this.isReconnect&&this.listeners.onclose&&this.listeners.onclose.apply(null,arguments),this.reconnectEnabled&&t.code<3e3&&this.backoff.backoff()}onErrorCallback(){this.listeners.onerror&&this.listeners.onerror.apply(null,arguments)}onMessageCallback(){this.listeners.onmessage&&this.listeners.onmessage.apply(null,arguments)}onOpenCallback(){this.listeners.onopen&&this.listeners.onopen.apply(null,arguments),this.isReconnect&&this.listeners.onreconnect&&this.listeners.onreconnect.apply(null,arguments),this.isReconnect=!1}get readyState(){return this.ws.readyState}close(t,e){void 0===t&&(t=1e3),this.reconnectEnabled=!1,this.ws.close(t,e)}send(t){this.ws.send(t)}set onclose(t){this.listeners.onclose=t}get onclose(){return this.listeners.onclose}set onerror(t){this.listeners.onerror=t}get onerror(){return this.listeners.onerror}set onmessage(t){this.listeners.onmessage=t}get onmessage(){return this.listeners.onmessage}set onopen(t){this.listeners.onopen=t}get onopen(){return this.listeners.onopen}set onreconnect(t){this.listeners.onreconnect=t}get onreconnect(){return this.listeners.onreconnect}reset(){this.backoff.reset()}reconnect(){this.onBackoffReady()}}S.CONNECTING=WebSocket.CONNECTING,S.OPEN=WebSocket.OPEN,S.CLOSING=WebSocket.CLOSING,S.CLOSED=WebSocket.CLOSED;var v=n(7561),_=n(385);var F=n(9749),I=n(4358),C=n(8760);class T extends F.EventEmitter{constructor(t,e,n){super(),this._streamingApi=t,this._accessToken=e,this._timeline=n,this._onStateChange=this._onStateChange.bind(this),this._onOnline=this._onOnline.bind(this),this._onOffline=this._onOffline.bind(this),this._onForcedOnlineStateChange=this._onForcedOnlineStateChange.bind(this),this._setupWebSocket(),this._setupEvents()}close(){this._closed=!0,this._closeWebSocket(),this._teardownEvents();for(const t of["open","close","reconnect","message"])this.removeAllListeners(t)}_closeWebSocket(){this._ws&&(this.emit("close"),this._ws.onopen=null,this._ws.onmessage=null,this._ws.onclose=null,this._ws.close(),this._ws=null)}_setupWebSocket(){const t=function(t,e,n){const s=`${t}/api/v1/streaming`,i={stream:function(t){switch(t){case"local":return"public:local";case"federated":return"public";case"home":return"user";case"notifications":return"user:notification";case"direct":return"direct"}return t.startsWith("tag/")?"hashtag":t.startsWith("list/")?"list":void 0}(n)};return n.startsWith("tag/")?i.tag=n.split("/").slice(-1)[0]:n.startsWith("list/")&&(i.list=n.split("/").slice(-1)[0]),e&&(i.access_token=e),s+"?"+(0,_.pe)(i)}(this._streamingApi,this._accessToken,this._timeline),e=new S(t);e.onopen=()=>{this._opened?this.emit("reconnect"):(this.emit("open"),this._opened=!0)},e.onmessage=t=>this.emit("message",(0,C.A)(t.data)),e.onclose=()=>this.emit("close"),this._ws=e}_setupEvents(){v.S.addEventListener("statechange",this._onStateChange),I.Y.on("forcedOnline",this._onForcedOnlineStateChange),window.addEventListener("online",this._onOnline),window.addEventListener("offline",this._onOffline)}_teardownEvents(){v.S.removeEventListener("statechange",this._onStateChange),I.Y.removeListener("forcedOnline",this._onForcedOnlineStateChange),window.removeEventListener("online",this._onOnline),window.removeEventListener("offline",this._onOffline)}_pause(){this._closed||this._closeWebSocket()}_unpause(){this._closed||(this._closeWebSocket(),this._setupWebSocket())}_onStateChange(t){"frozen"===t.newState?this._pause():"frozen"===t.oldState&&this._unpause(),"active"===t.newState&&this._tryToReconnect()}_onOnline(){this._unpause(),this._tryToReconnect()}_onOffline(){this._pause()}_onForcedOnlineStateChange(t){t?this._unpause():this._pause()}_tryToReconnect(){this._ws&&this._ws.readyState,this._ws&&this._ws.readyState!==S.OPEN&&(this._ws.reset(),this._ws.reconnect())}}var E=n(5041),k=n(1505),O=n(1162),A=n(9970);function N(t,e){(0,A.F)((()=>{!async function(t,e){await O.F.updateStatus(t,e)}(t,e)}))}const R=["update","delete","notification","conversation","filters_changed","status.update"];var x=n(9076);const D=20,W=15;function j(t,e,n,s,i,r){const a=(t,s)=>{s&&async function(t,e,n,s){let i,o=null,r=0;do{r++,i=(await(0,x.V)(t,e,n,o,s,D)).items,i.length&&((0,k.b)(t,n,i),o=i[i.length-1].id)}while(r<W&&i.length===D)}(e,n,t,s)};return new T(t,n,s).on("message",(t=>{!function(t,e,n){let{event:s,payload:i}=n||{};if(R.includes(s)){switch((0,o.B)("processMessage"),["update","notification","conversation","status.update"].includes(s)&&(i=JSON.parse(i)),s){case"delete":(0,E.d)(t,i);break;case"update":(0,k.I)(t,e,i);break;case"notification":(0,k.I)(t,"notifications",i),"mention"===i.type&&(0,k.I)(t,"notifications/mentions",i);break;case"conversation":i.last_status&&(0,k.I)(t,e,i.last_status);break;case"filters_changed":(0,I.j)("wordFiltersChanged",t);break;case"status.update":N(t,i)}(0,o.s)("processMessage")}else console.warn("ignoring message from server",n)}(e,s,t)})).on("open",(()=>{a(s,i),"home"===s&&a("notifications",r)})).on("close",(()=>{})).on("reconnect",(()=>{const t=u.h.getFirstTimelineItemId(e,s);if(a(s,t),"home"===s){const t=u.h.getFirstTimelineItemId(e,"notifications");a("notifications",t)}}))}var U=n(5060),P=n(7376),$=n(4989),B=n(6677);let L;async function M(t,e){(0,o.B)(`refreshInstanceDataAndStream-${e}`),await async function(t,e){if(q(t,e))return;if(await async function(t){(0,A.F)((()=>(0,P.ic)(t))),(0,A.F)((()=>(0,y.L)(t))),(0,A.F)((()=>(0,B.cd)(t))),(0,A.F)((()=>(0,U.Z)(t))),await Promise.all([(0,w.Q)(t),(0,w.Ac)(t).then((()=>{(0,A.F)((()=>(0,$.Z)(t)))}))])}(e),q(t,e))return;const{currentInstanceInfo:n}=t.get();if(!n)return;!function(t,e,n){const{accessToken:s}=t.get(),i=n.urls.streaming_api,o=t.getFirstTimelineItemId(e,"home"),r=t.getFirstTimelineItemId(e,"notifications");L=j(i,e,s,"home",o,r),!1}(t,e,n)}(t,e),(0,o.s)(`refreshInstanceDataAndStream-${e}`)}function q(t,e){return t.get().currentInstance!==e}function z(){let t;u.h.observe("currentTimeline",(async e=>{if(t&&(t.close(),t=null),!(n=e)||"local"!==n&&"federated"!==n&&"direct"!==n&&!n.startsWith("list/")&&!n.startsWith("tag/"))return;var n;const{currentInstance:s}=u.h.get(),{accessToken:i}=u.h.get();await(0,w.Q)(s);if(!(()=>{const{currentInstance:t,currentTimeline:n}=u.h.get();return t===s&&n===e})())return;const o=u.h.getFirstTimelineItemId(s,e),{currentInstanceInfo:r}=u.h.get(),a=r.urls.streaming_api;t=j(a,s,i,e,o)}))}var H=n(5233);let G=!1;function V(){u.h.observe("hasNotifications",(t=>{var e;e=()=>{G!==t&&(function(t){const e="theFavicon",n=document.getElementById(e);if(n.getAttribute("href")===t)return;const s=document.createElement("link");s.id=e,s.rel="shortcut icon",s.type="image/png",s.href=t,document.head.removeChild(n),document.head.appendChild(s)}(`/icons/favicon${t?"-alert":""}.ico`),G=!G)},u.h.get().pageVisibilityHidden?e():(0,H.t)()?(0,A.F)(e):requestAnimationFrame(e)}))}var Z=n(5818);const Q=4;function X(t){let e=!1;return(0,A.F)((async()=>{if(e)return;const n=await async function(t){let e=await Z.jk(t);const n=[];if(t.startsWith(":")&&t.endsWith(":")){const n=t.substring(1,t.length-1).toLowerCase();e=e.filter((t=>t.shortcodes.includes(n)))}for(const s of e){if(n.length===Q)break;(s.url||s.unicode)&&n.push(s)}return n}(t);e||u.h.setForCurrentAutosuggest({autosuggestType:"emoji",autosuggestSelected:0,autosuggestSearchResults:n})})),{cancel:()=>{e=!0}}}var K=n(7662),J=n(6637),Y=n(4285);const tt=new class{constructor(t){this._timeout=t,this._promise=Promise.resolve()}next(){const t=this._promise;return this._promise=this._promise.then((()=>new Promise((t=>setTimeout(t,this._timeout))))),t}}(200);class et{constructor(t){this._canceled=!1,this._controller="function"==typeof AbortController&&new AbortController,this._fetcher=t}async request(){if(this._canceled)throw new Error("canceled");if(await tt.next(),this._canceled)throw new Error("canceled");const t=this._controller&&this._controller.signal;return this._fetcher(t)}cancel(){this._canceled=!0,this._controller&&(this._controller.abort(),this._controller=null)}}const nt=30;function st(t,e){const n=t.acct.toLowerCase(),s=e.acct.toLowerCase();return n<s?-1:n===s?0:1}function it(t){return t.id}function ot(t){let e,n,s=!1;const{currentInstance:i,accessToken:o}=u.h.get(),r=new et((async function(e){return(await(0,K.y)(i,o,t,!1,Q,!1,e)).accounts}));function a(){if(s)return;const t=function(){let t=(e||[]).slice().sort(st).slice(0,Q);if(t.length<Q){const e=(n||[]).sort(st).slice(0,Q-t.length);t=(0,J.z)(t,e),t=(0,Y.mN)(t,it)}return t}();u.h.setForCurrentAutosuggest({autosuggestType:"account",autosuggestSelected:0,autosuggestSearchResults:t})}function c(t){console.warn("ignored autosuggest error",t)}return(0,A.F)((()=>{s||(async function(){e=await O.F.searchAccountsByUsername(i,t.substring(1),nt)}().then(a).catch(c),async function(){n=await r.request()}().then(a).catch(c))})),{cancel:()=>{s=!0,r.cancel()}}}const rt=10;function at(t){return t.uses}function ct(t,e){if(t.history&&e.history&&t.history.length&&e.history.length){const n=(0,s.Sm)(t.history.map(at)),i=(0,s.Sm)(e.history.map(at));return n>i?-1:n<i?1:0}return t.name<e.name?-1:t.name>e.name?1:0}function lt(){let t;u.h.observe("autosuggestSearchText",(async e=>{t&&(t.cancel(),t=null);const{composeFocused:n}=u.h.get(),s=u.h.getForCurrentAutosuggest("autosuggestSelecting");n&&e&&!s?t=e.startsWith(":")?X(e):e.startsWith("#")?function(t){const{currentInstance:e,accessToken:n}=u.h.get(),s=new et((async function(s){return(await(0,K.y)(e,n,t,!1,rt,!0,s)).hashtags.sort(ct).slice(0,Q)}));return(0,A.F)((async()=>{try{const t=await s.request();u.h.setForCurrentAutosuggest({autosuggestType:"hashtag",autosuggestSelected:0,autosuggestSearchResults:t})}catch(t){console.warn("ignored autosuggest error",t)}})),{cancel:()=>{s.cancel()}}}(e):ot(e):u.h.setForCurrentAutosuggest({autosuggestSelected:0,autosuggestSearchResults:[]})}))}const ut=document.getElementById("theScrollbarStyle");var ht=n(5500);var mt=n(370),ft=n(7234);function dt(){const t=Date.now();let e=0;const{composeData:n}=u.h.get();for(const s of Object.values(n))for(const[n,i]of Object.entries(s)){if("home"===n||"dialog"===n)continue;t-(i.ts||0)>mt.f&&(delete s[n],e++)}e&&u.h.set({composeData:n})}function gt(){(0,A.F)(dt)}var pt=n(2828);var wt=n(7553),yt=n(9603);function bt(){let t=!1;u.h.observe("currentVerifyCredentials",(async e=>{if(e&&!t){t=!0;const{currentPage:e}=u.h.get();"home"===e&&"true"===new URLSearchParams(location.search).get("compose")&&await async function(){const{isUserLoggedIn:t}=u.h.get();if(!t)return;const e=(0,wt.B)(),n=await O.F.getWebShareData();n&&await O.F.deleteWebShareData();const{title:s,text:i,url:o,file:r}=n||{},a=[s,i,o].filter(Boolean).join("\n\n"),[c,l]=await Promise.all([e,Promise.resolve(new URLSearchParams(location.search).get("retweet")).then((t=>t&&fetch(Object.assign(new URL(t),{hostname:"birdlink.easrng.workers.dev"}).href))).then((t=>t.text())).catch((t=>console.warn("failed to load tweet",t)))]);u.h.clearComposeData("dialog"),u.h.setComposeData("dialog",{text:a||l}),u.h.save(),c(),r&&(0,yt.m)("dialog",r)}()}}))}var St=n(9849);const vt=(0,n(8978).I)((()=>(0,St.i)()&&"undefined"==typeof cookieStore));var _t=new Map;function Ft(t){if(_t.has(t))return _t.get(t);var e=It(t);return _t.set(t,e),e}var It=function(){var t=null;try{t=document.createElement("canvas").getContext("2d")}catch(s){}if(!t)return function(){return!1};var e=20,n=Math.floor(12.5);return t.font=n+"px Arial, Sans-Serif",t.textBaseline="top",t.canvas.width=40,t.canvas.height=25,function(n){t.clearRect(0,0,40,25),t.fillStyle="#FF0000",t.fillText(n,0,22),t.fillStyle="#0000FF",t.fillText(n,e,22);for(var s=t.getImageData(0,0,e,25).data,i=s.length,o=0;o<i&&!s[o+3];o+=4);if(o>=i)return!1;var r=e+o/4%e,a=Math.floor(o/4/e),c=t.getImageData(r,a,1,1).data;return s[o]===c[0]&&s[o+2]===c[2]&&!(t.measureText(n).width>=e)}}();let Ct=!1;const Tt="/TwemojiCountryFlags.woff2";function Et(){if(!Ct){Ct=!0;const t=document.head.querySelectorAll("style").length;!function(t="Twemoji Country Flags",e="https://cdn.jsdelivr.net/npm/country-flag-emoji-polyfill@0.1/dist/TwemojiCountryFlags.woff2"){if(Ft("😊")&&!Ft("🇨🇭")){const n=document.createElement("style");return n.textContent=`@font-face {\n      font-family: "${t}";\n      unicode-range: U+1F1E6-1F1FF, U+1F3F4, U+E0062-E0063, U+E0065, U+E0067,\n        U+E006C, U+E006E, U+E0073-E0074, U+E0077, U+E007F;\n      src: url('${e}') format('woff2');\n      font-display: swap;\n    }`,document.head.appendChild(n),!0}}("Twemoji Mozilla",Tt);const e=document.head.querySelectorAll("style").length!==t;if(e){const t=document.createElement("style");t.textContent=`\n        @font-face {\n          font-family: CountryFlagEmojiPolyfill;\n          src: url(${JSON.stringify(Tt)});\n        }\n      `,document.head.appendChild(t)}u.h.set({polyfilledCountryFlagEmoji:e})}}const kt=document.getElementById("theCenterNavStyle");function Ot(t,e){const n=e;try{if(!t.startsWith("status/"))return e;const i={};for(const l of e)l.replyId&&(i[l.replyId]=i[l.replyId]||[],i[l.replyId].push(l));function o(e,n=0){const s=e.id===t.slice(7);s&&(n=0);const r=[{...e,level:n},...(i[e.id]||[]).map((t=>o(t,n+1)))].flat();return s&&(r[0].subtree=r[0].subtree||{},r[0].subtree.start=!0,r[r.length-1].subtree=r[r.length-1].subtree||{},r[r.length-1].subtree.end=!0),r}const r=e.length>0?o(e[0]):[],a=new Set(r.map((t=>t.id))),c=[];for(const u of e)a.has(u.id)||(c.push(u),console.warn("reorder is missing a status. this could be a bug or it could not be. who knows.",{summary:u,summaries:e,reordered:r,timelineName:t,replyChildren:i}));return[...r,...c]}catch(s){return console.error(s),n}}function At(t,e,n,s,i){const o=function(t,e){const{statusModifications:n}=t.get();return n[e]=Object.assign({favorites:{},reblogs:{},pins:{},bookmarks:{},reactions:{}},n[e]||{}),n}(t,e);o[e][s][n]=i,t.set({statusModifications:o})}var Nt;(Nt=u.A).prototype.setComposeData=function(t,e){const{composeData:n,currentInstance:s}=this.get(),i=n[s]=n[s]||{};i[t]=Object.assign(i[t]||{},{ts:Date.now()},e),this.set({composeData:n})},Nt.prototype.getComposeData=function(t,e){const{composeData:n,currentInstance:i}=this.get();return(0,s.U2)(n,[i,t,e])},Nt.prototype.clearComposeData=function(t){const{composeData:e,currentInstance:n}=this.get();e&&e[n]&&delete e[n][t],this.set({composeData:e})},function(t){t.prototype.setForTimeline=function(t,e,n){const s={};for(const i of Object.keys(n)){"timelineItemSummaries"===i&&(n[i]=Ot(e,n[i]));const o=`timelineData_${i}`,r=this.get()[o]||{};(r[t]=r[t]||{})[e]=n[i],s[o]=r}this.set(s)},t.prototype.getForTimeline=function(t,e,n){const i=`timelineData_${n}`,o=this.get()[i];return(0,s.U2)(o,[t,e])},t.prototype.getAllTimelineData=function(t,e){return(this.get()[`timelineData_${e}`]||{})[t]||{}},t.prototype.getFirstTimelineItemId=function(t,e){return i(this.getForTimeline(t,e,"timelineItemSummaries"))},t.prototype.setForCurrentTimeline=function(t){const{currentInstance:e,currentTimeline:n}=this.get();this.setForTimeline(e,n,t)},t.prototype.getThreads=function(t){const e=this.getAllTimelineData(t,"timelineItemSummaries");return(0,s.D9)(e,((t,e)=>e.startsWith("status/")))},t.prototype.clearTimelineDataForInstance=function(t){const e={};Object.entries(this.get()).forEach((([n,s])=>{n.startsWith("timelineData_")&&s&&(delete s[t],e[n]=s)})),this.set(e)}}(u.A),function(t){t.prototype.setStatusFavorited=function(t,e,n){At(this,t,e,"favorites",n)},t.prototype.setStatusReblogged=function(t,e,n){At(this,t,e,"reblogs",n)},t.prototype.setStatusPinned=function(t,e,n){At(this,t,e,"pins",n)},t.prototype.setStatusBookmarked=function(t,e,n){At(this,t,e,"bookmarks",n)},t.prototype.setStatusReacted=function(t,e,n,s){At(this,t,e+"-"+n.name,"reactions",s)}}(u.A),function(t){t.prototype.setForAutosuggest=function(t,e,n){const s={};for(const i of Object.keys(n)){const o=`autosuggestData_${i}`,r=this.get()[o]||{};(r[t]=r[t]||{})[e]=n[i],s[o]=r}this.set(s)},t.prototype.setForCurrentAutosuggest=function(t){const{currentInstance:e,currentComposeRealm:n}=this.get();this.setForAutosuggest(e,n,t)},t.prototype.getForCurrentAutosuggest=function(t){const{currentInstance:e,currentComposeRealm:n}=this.get();return(0,s.U2)(this.get()[`autosuggestData_${t}`],[e,n])},t.prototype.clearAutosuggestDataForInstance=function(t){const e={};Object.entries(this.get()).forEach((([n,s])=>{n.startsWith("autosuggestData_")&&s&&(delete s[t],e[n]=s)})),this.set(e)}}(u.A),(0,o.B)("loggedInComputations"),function(t){t.compute("currentFilters",["unexpiredInstanceFilters","currentInstance"],((t,e)=>t[e]||[])),t.compute("unexpiredInstanceFilterRegexes",["unexpiredInstanceFilters"],(t=>Object.fromEntries(Object.entries(t).map((([t,e])=>[t,Object.fromEntries(m.j6.map((t=>{const n=e.filter((e=>e.context.includes(t)));if(!n.length)return;const s=h(n);return[t,s]})).filter(Boolean))])))))}(u.h),function(t){(0,o.B)("timelineComputations"),r(t,"timelineItemSummaries",null),r(t,"timelineItemSummariesToAdd",null),r(t,"runningUpdate",!1),r(t,"lastFocusedElementId",null),r(t,"ignoreBlurEvents",!1),r(t,"showHeader",!1),r(t,"shouldShowHeader",!1),r(t,"timelineItemSummariesAreStale",!1),r(t,"timelineNextPageId",null),t.compute("currentTimelineType",["currentTimeline"],(t=>t&&t.split("/")[0])),t.compute("currentTimelineValue",["currentTimeline"],(t=>{if(!t)return;const e=t.split("/"),n=e.length;return"with_replies"===e[n-1]||"media"===e[n-1]?e[n-2]:e[n-1]})),t.compute("firstTimelineItemId",["timelineItemSummaries"],(t=>i(t))),t.compute("lastTimelineItemId",["timelineItemSummaries"],(t=>{return(e=t)&&e[e.length-1]&&e[e.length-1].id;var e})),(0,o.s)("timelineComputations")}(u.h),function(t){g(t,"timelineShowReblogs",{home:f.Z3,notifications:f.cT}),g(t,"timelineShowReplies",{home:f.B$}),g(t,"timelineShowFollows",{notifications:f.dS}),g(t,"timelineShowFavs",{notifications:f.AL}),g(t,"timelineShowMentions",{notifications:f.M9}),g(t,"timelineShowPolls",{notifications:f.rs}),g(t,"timelineShowSubscriptions",{notifications:f.sr}),p(t,"timelineNotificationShowReblogs",f.cT),p(t,"timelineNotificationShowFollows",f.dS),p(t,"timelineNotificationShowFavs",f.AL),p(t,"timelineNotificationShowMentions",f.M9),p(t,"timelineNotificationShowPolls",f.rs),p(t,"timelineNotificationShowSubscriptions",f.sr),t.compute("timelineWordFilterContext",["currentTimeline"],(t=>{if(t)return"home"===t||t.startsWith("list/")?m.Ny:"notifications"===t||t.startsWith("notifications/")?m.zW:"federated"===t||"bubble"===t||"local"===t||t.startsWith("tag/")?m.wM:t.startsWith("account/")?m.aO:t.startsWith("status/")?m.IO:void 0})),t.compute("timelineFilterFunction",["timelineShowReblogs","timelineShowReplies","timelineShowFollows","timelineShowFavs","timelineShowMentions","timelineShowPolls","timelineShowSubscriptions","timelineWordFilterContext"],((t,e,n,s,i,o,r,a)=>d(t,e,n,s,i,o,r,a))),t.compute("timelineNotificationFilterFunction",["timelineNotificationShowReblogs","timelineNotificationShowFollows","timelineNotificationShowFavs","timelineNotificationShowMentions","timelineNotificationShowPolls","timelineNotificationShowSubscriptions"],((t,e,n,s,i,o)=>d(t,!0,e,n,s,i,o,m.zW))),t.compute("filteredTimelineItemSummaries",["timelineItemSummaries","timelineFilterFunction"],((t,e)=>t&&t.filter(e))),t.compute("filteredTimelineItemSummariesToAdd",["timelineItemSummariesToAdd","timelineFilterFunction"],((t,e)=>t&&t.filter(e))),t.compute("timelineNotificationItemSummaries",["timelineData_timelineItemSummariesToAdd","timelineFilterFunction","currentInstance"],((t,e,n)=>(0,s.U2)(t,[n,"notifications"]))),t.compute("filteredTimelineNotificationItemSummaries",["timelineNotificationItemSummaries","timelineNotificationFilterFunction"],((t,e)=>t&&t.filter(e)))}(u.h),function(t){t.compute("numberOfNotifications",["filteredTimelineNotificationItemSummaries","disableNotificationBadge"],((t,e)=>!e&&t?t.length:0)),t.compute("hasNotifications",["numberOfNotifications","currentPage"],((t,e)=>"notifications"!==e&&!!t)),t.compute("numberOfFollowRequests",["followRequestCounts","currentInstance","disableFollowRequestCount"],((t,e,n)=>n?0:(0,s.U2)(t,[e],0))),t.compute("hasFollowRequests",["numberOfFollowRequests"],(t=>!!t)),t.compute("badgeNumber",["numberOfFollowRequests","numberOfNotifications"],((t,e)=>t+e))}(u.h),function(t){(0,o.B)("autosuggestComputations"),l(t,"composeFocused",!1),l(t,"composeSelectionStart",0),l(t,"autosuggestSelected",0),l(t,"autosuggestSearchResults",[]),l(t,"autosuggestType",null),t.compute("currentComposeText",["currentComposeData","currentComposeRealm"],((t,e)=>(0,s.U2)(t,[e,"text"],""))),t.compute("autosuggestSearchText",["currentComposeText","composeSelectionStart"],((t,e)=>{const n=e;if(!t||n<a)return"";const s=t.substring(0,n).match(c);return s&&s[1]||""})),t.compute("autosuggestNumSearchResults",["autosuggestSearchResults"],(t=>t.length)),t.compute("autosuggestShown",["composeFocused","autosuggestSearchText","autosuggestNumSearchResults"],((t,e,n)=>!!(t&&e&&n))),(0,o.s)("autosuggestComputations")}(u.h),(0,o.s)("loggedInComputations"),u.h.observe("currentInstance",(async t=>{L&&(L.close(),L=null),t&&(0,A.F)((()=>M(u.h,t)))})),z(),function(){function t(t,e){const n=Object.fromEntries(Object.entries(e).map((([e,n])=>[e,n.filter((e=>!e.expires_at||new Date(e.expires_at).getTime()>=t))])));(0,Y.Xy)(u.h.get().unexpiredInstanceFilters,n)||u.h.set({unexpiredInstanceFilters:n})}(0,I.on)("wordFiltersChanged",(t=>{(0,B.A_)(t)})),u.h.observe("now",(e=>{const{instanceFilters:n}=u.h.get();t(e,n)})),u.h.observe("instanceFilters",(e=>{const{now:n}=u.h.get();t(n,e)})),u.h.observe("unexpiredInstanceFilterRegexes",(async t=>{(0,o.B)("update timeline item summary filter contexts");let{timelineData_timelineItemSummaries:e,timelineData_timelineItemSummariesToAdd:n}=u.h.get();e=e||{},n=n||{};let s=!1;if(await Promise.all(Object.entries(t).map((async([t,i])=>{const o=e[t]||{},r=n[t]||{},a=[...Object.values(o).flat(),...Object.values(r).flat()];a.length,await Promise.all(a.map((async e=>{try{const n=e.type,o=await(n?O.F.getNotification(t,e.id):O.F.getStatus(t,e.id)),r=(0,pt.b)(o,i);(0,Y.Xy)(e.filterContexts,r)||(s=!0,e.filterContexts=r)}catch(n){console.error(n)}})))}))),s){const{timelineData_timelineItemSummaries:t,timelineData_timelineItemSummariesToAdd:e}=u.h.get();u.h.set({timelineData_timelineItemSummaries:t,timelineData_timelineItemSummariesToAdd:e})}(0,o.s)("update timeline item summary filter contexts")}),{init:!1})}(),V(),lt(),navigator.permissions&&navigator.permissions.query&&navigator.permissions.query({name:"notifications"}).then((t=>{u.h.set({notificationPermission:t.state}),t.onchange=t=>{u.h.set({notificationPermission:t.target.state})}})),u.h.observe("disableCustomScrollbars",(t=>{ut.setAttribute("media",t?"only x":"all")}),{init:!1}),u.h.observe("centerNav",(t=>{kt.setAttribute("media",t?"all":"only x")}),{init:!1}),function(){function t(t,e){const n=(0,ht.x)(t,e);Z.fK(n)}u.h.observe("currentCustomEmoji",(e=>{t(e,u.h.get().autoplayGifs)}),{init:!1}),u.h.observe("autoplayGifs",(e=>{t(u.h.get().currentCustomEmoji,e)}),{init:!1})}(),bt(),!vt()&&"setAppBadge"in navigator&&u.h.observe("badgeNumber",(t=>{t?navigator.setAppBadge(t):navigator.clearAppBadge()})),(0,ft._)(gt,mt.P,!1),Et()},5500:(t,e,n)=>{function s(t,e){return t?t.filter((t=>t.visible_in_picker)).map((t=>({name:t.shortcode,shortcodes:[t.shortcode],url:e?t.url:t.static_url,category:t.category}))):[]}n.d(e,{x:()=>s})},5818:(t,e,n)=>{n.d(e,{XB:()=>l,fK:()=>c,jk:()=>u});var s=n(8289),i=n(7561),o=n(9805);let r;function a(){r||(r=new s.Z({locale:o.FO,dataSource:o.jN}))}function c(t){a(),r.customEmoji=t}async function l(t){return a(),r.getEmojiByUnicodeOrName(t)}async function u(t){a();const[e,n]=await Promise.all([r.getEmojiBySearchQuery(t),r.getPreferredSkinTone()]);return e.map((t=>function(t,e){if(!t||t.url)return t;const n={unicode:t.unicode,shortcodes:t.shortcodes};if(e>0&&t.skins){const s=t.skins.find((t=>t.tone===e));s&&(n.unicode=s.unicode)}return n}(t,n)))}i.S.addEventListener("statechange",(t=>{"frozen"===t.newState&&r&&r.close()}))},5233:(t,e,n)=>{n.d(e,{t:()=>s});const s=(0,n(8978).I)((()=>navigator.userAgent.match(/(?:iPhone|iPod|iPad|Android|KAIOS)/)))}}]);
//# sourceMappingURL=668.9d490d65e1f1c46b76ee.668.js.map