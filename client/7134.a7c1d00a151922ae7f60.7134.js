"use strict";(this.webpackChunk=this.webpackChunk||[]).push([[7134],{7134:(t,e,n)=>{n.r(e),n.d(e,{DELETE_AFTER:()=>_e,clearDatabaseForInstance:()=>at,closeKeyValIDBConnection:()=>de,deleteCachedMediaFile:()=>Be,deleteStatusesAndNotifications:()=>Vt,deleteWebShareData:()=>ue,getAccount:()=>ot,getAllCachedFileIds:()=>xe,getCachedMediaFile:()=>ve,getCustomEmoji:()=>te,getFilters:()=>oe,getFollowRequestCount:()=>ne,getIconColors:()=>we,getInstanceInfo:()=>Jt,getInstanceVerifyCredentials:()=>Zt,getLastTheme:()=>ge,getLists:()=>Xt,getNotification:()=>Pt,getNotificationIdsForStatuses:()=>ut,getPinnedStatuses:()=>Kt,getReblogsForStatus:()=>it,getRelationship:()=>re,getStatus:()=>jt,getTimeline:()=>Ft,getWebShareData:()=>fe,insertPinnedStatuses:()=>Et,insertStatus:()=>xt,insertTimelineItems:()=>Bt,searchAccountsByUsername:()=>rt,setAccount:()=>ct,setCachedMediaFile:()=>De,setCustomEmoji:()=>ee,setDeleteCachedMediaFilesAfter:()=>ke,setFilters:()=>ce,setFollowRequestCount:()=>se,setIconColors:()=>ye,setInstanceInfo:()=>Qt,setInstanceVerifyCredentials:()=>Gt,setLastTheme:()=>he,setLists:()=>Yt,setRelationship:()=>ae,setStatusBookmarked:()=>Wt,setStatusFavorited:()=>Nt,setStatusMuted:()=>Tt,setStatusPinned:()=>Ot,setStatusReblogged:()=>Mt,setWebShareData:()=>le,updateStatus:()=>qt});const s="statuses-v4",o="status_timelines-v4",c="meta-v4",r="accounts-v4",a="relationships-v4",i="notifications-v4",u="notification_timelines-v4",l="pinned_statuses-v4",f="threads-v4",d="__pinafore_ts",h="__pinafore_acct_id",g="__pinafore_status_id",y="__pinafore_reblog_id",w="__pinafore_acct_lc",m={version:12},b={now:()=>Date.now()};var p=n(4698);const _={maxSize:100,caches:{}},S={maxSize:50,caches:{}},I={maxSize:20,caches:{}},C={maxSize:20,caches:{}},v={maxSize:50,caches:{}};function D(t,e){let n=t.caches[e];return n||(n=t.caches[e]=new p.c({maxSize:t.maxSize})),n}function B(t,e){delete t.caches[e]}function x(t){const e=[_,S,I,C,v];for(const n of e)B(n,t)}function k(t,e,n,s){return D(t,e).set(n,s)}function A(t,e,n){return D(t,e).get(n)}function E(t,e,n){return D(t,e).has(n)}function K(t,e,n){D(t,e).delete(n)}var R=n(7561);class z{constructor(t="keyval-store",e="keyval"){this.storeName=e,this._dbName=t,this._storeName=e,this._init()}_withIDBStore(t,e){return this._init(),this._dbp.then((n=>new Promise(((s,o)=>{const c=n.transaction(this.storeName,t);c.oncomplete=()=>s(),c.onabort=c.onerror=()=>o(c.error),e(c.objectStore(this.storeName))}))))}_init(){this._dbp||(this._dbp=new Promise(((t,e)=>{const n=indexedDB.open(this._dbName,1);n.onerror=()=>e(n.error),n.onsuccess=()=>t(n.result),n.onupgradeneeded=()=>{n.result.createObjectStore(this._storeName)}})))}_close(){return this._init(),this._dbp.then((t=>{t.close(),this._dbp=void 0}))}}let F;function j(){return F||(F=new z),F}function P(t){let e;return j()._withIDBStore("readonly",(n=>{e=n.get(t)})).then((()=>e.result))}function L(t,e){return j()._withIDBStore("readwrite",(n=>{n.put(e,t)}))}function N(t){return j()._withIDBStore("readwrite",(e=>{e.delete(t)}))}function M(){const t=j(),e=[];return t._withIDBStore("readonly",(t=>{(t.openKeyCursor||t.openCursor).call(t).onsuccess=function(){this.result&&(e.push(this.result.key),this.result.continue())}})).then((()=>e))}function O(){return j()._close()}R.S.addEventListener("statechange",(async t=>{"frozen"===t.newState&&await O()}));const T="known-instance-";var W=n(3274);const $=[{version:9,migration:function(t,e,n){function h(e,n,s){const o=n?t.createObjectStore(e,n):t.createObjectStore(e);s&&Object.keys(s).forEach((t=>{o.createIndex(t,s[t])}))}h(s,{keyPath:"id"},{[d]:d,[y]:y}),h(o,null,{statusId:""}),h(i,{keyPath:"id"},{[d]:d,[g]:g}),h(u,null,{notificationId:""}),h(r,{keyPath:"id"},{[d]:d}),h(a,{keyPath:"id"},{[d]:d}),h(f,null,{statusId:""}),h(l,null,{statusId:""}),h(c),n()}},{version:10,migration:function(t,e,n){e.objectStore(r).createIndex(w,w),n()}},{version:12,migration:function(t,e,n){const s=[o,u];let c=0;s.forEach((t=>{const o=e.objectStore(t);o.openCursor().onsuccess=t=>{const{result:e}=t.target;if(e){const{key:t,value:n}=e,s=t.split("\0")[0]+"\0"+(0,W.hC)(n);o.delete(t).onsuccess=()=>{o.add(n,s).onsuccess=()=>{e.continue()}}}else++c===s.length&&n()}}))}}];var q=n(9970);const V={},H={};async function U(t){if(!t)throw new Error("instanceName is undefined in getDatabase()");return H[t]||(H[t]=await function(t){return new Promise(((e,n)=>{const s=indexedDB.open(t,m.version);V[t]=s,s.onerror=n,s.onblocked=()=>{console.error("idb blocked")},s.onupgradeneeded=t=>{const e=s.result,n=t.currentTarget.transaction,o=$.filter((({version:e})=>t.oldVersion<e));!function t(){if(!o.length)return;const{migration:s}=o.shift();s(e,n,t)}()},s.onsuccess=()=>e(s.result)}))}(t),await async function(t){return L(T+t,!0)}(t)),H[t]}async function Z(t,e,n,s){return new Promise(((o,c)=>{const r=t.transaction(e,n),a="string"==typeof e?r.objectStore(e):e.map((t=>r.objectStore(t)));let i;s(a,(t=>{i=t})),r.oncomplete=()=>o(i),r.onerror=()=>c(r.error)}))}function G(t){return new Promise(((e,n)=>{const s=V[t];s&&s.result&&s.result.close(),delete V[t],delete H[t];const o=indexedDB.deleteDatabase(t);o.onsuccess=()=>e(),o.onerror=()=>n(o.error),o.onblocked=()=>console.error(`database ${t} blocked`)})).then((()=>async function(t){return N(T+t)}(t))).then((()=>x(t)))}async function J(t,e,n,s){if(E(e,n,s))return A(e,n,s);const o=await U(n),c=await Z(o,t,"readonly",((t,e)=>{t.get(s).onsuccess=t=>e(t.target.result)}));return k(e,n,s,c),c}async function Q(t,e,n,s){k(e,n,s.id,s);return Z(await U(n),t,"readwrite",(t=>{t.put(s)}))}function X(t){const e={},n=Object.keys(t);for(const s of n){const n=t[s];if(n&&(!Array.isArray(n)||0!==n.length))switch(s){case"account":e[h]=n.id;break;case"status":e[g]=n.id;break;case"reblog":e[y]=n.id;break;case"acct":e[s]=n,e[w]=n.toLowerCase();break;default:e[s]=n}}return e[d]=b.now(),e}function Y(t,e){return t+"\0"+(0,W.hC)(e)}function tt(t,e){const n=e&&(0,W.hC)(e),s=n?t+"\0"+n:t+"\0",o=t+"\0￿";return IDBKeyRange.bound(s,o,!0,!0)}function et(t,e){return t+"\0"+(0,W.Bu)(e,5)}function nt(t){return IDBKeyRange.bound(t+"\0",t+"\0￿")}function st(t){return IDBKeyRange.bound(t+"\0",t+"\0￿")}async function ot(t,e){return J(r,S,t,e)}async function ct(t,e){return Q(r,S,t,X(e))}async function rt(t,e,n){n=n||20;return Z(await U(t),r,"readonly",((t,s)=>{const o=(c=e.toLowerCase(),IDBKeyRange.bound(c,c+"￿"));var c;t.index(w).getAll(o,n).onsuccess=t=>{s(t.target.result)}}))}async function at(t){B(_,t),B(S,t),B(C,t),await G(t)}async function it(t,e){const n=await U(t);await Z(n,s,"readonly",((t,n)=>{t.index(y).getAll(IDBKeyRange.only(e)).onsuccess=t=>{n(t.target.result)}}))}async function ut(t,e){return Z(await U(t),i,"readonly",((t,n)=>{const s=[];n(s),e.forEach((e=>{t.index(g).getAllKeys(IDBKeyRange.only(e)).onsuccess=t=>{for(const e of t.target.result)s.push(e)}}))}))}function lt(t,e){k(_,e,t.id,t),k(S,e,t.account.id,t.account),t.reblog&&k(S,e,t.reblog.account.id,t.reblog.account)}R.S.addEventListener("statechange",(t=>{"frozen"===t.newState&&Object.keys(V).forEach((t=>{!function(t){const e=V[t];e&&e.result&&e.result.close(),delete V[t],delete H[t],x(t)}(t)}))})),(0,q.F)((()=>N("./eng.traineddata")));var ft=n(4285),dt=n(85),ht=n(6373),gt=n(8183);function yt(t,e,n){e.getAllKeys(n).onsuccess=e=>{for(const n of e.target.result)t.delete(n)}}var wt=n(370);const mt=20;function bt(t,e){!function n(){t().onsuccess=function(t){const s=t.target.result;e(s),s.length&&n()}}()}async function pt(t){(0,gt.B)(`cleanup:${t}`);const e=await U(t),n=[s,o,i,u,r,a,f,l];await Z(e,n,"readwrite",(t=>{const[e,n,s,o,c,r,a,i]=t,u=Date.now()-wt.f;!function(t,e,n,s){bt((()=>t.index(d).getAllKeys(IDBKeyRange.upperBound(s),mt)),(s=>{s.forEach((s=>{t.delete(s),yt(e,e.index("statusId"),IDBKeyRange.only(s)),yt(n,n,nt(s))}))}))}(e,n,a,u),function(t,e,n){bt((()=>t.index(d).getAllKeys(IDBKeyRange.upperBound(n),mt)),(n=>{n.forEach((n=>{t.delete(n),yt(e,e.index("notificationId"),IDBKeyRange.only(n))}))}))}(s,o,u),function(t,e,n){bt((()=>t.index(d).getAllKeys(IDBKeyRange.upperBound(n),mt)),(n=>{n.forEach((n=>{t.delete(n),yt(e,e,st(n))}))}))}(c,i,u),function(t,e){bt((()=>t.index(d).getAllKeys(IDBKeyRange.upperBound(e),mt)),(e=>{e.forEach((e=>{t.delete(e)}))}))}(r,u)})),(0,gt.s)(`cleanup:${t}`)}function _t(t){(0,q.F)((()=>pt(t)))}const St=(0,ht.D)((async function(){const t=await async function(){return(await M()).filter((t=>t.startsWith(T))).map((t=>t.substring(T.length)))}();for(const e of t)_t(e)}),wt.P);function It(t,e){t.put(X(e))}function Ct(t,e){t.put(X(e))}function vt(t,e,n){It(t,n),Ct(e,n.account),n.reblog&&(It(t,n.reblog),Ct(e,n.reblog.account))}function Dt(t,e,n,s){s.status&&vt(e,n,s.status),function(t,e){Ct(t,e)}(n,s.account),function(t,e){t.put(X(e))}(t,s)}async function Bt(t,e,n){if(St(),"notifications"===e||"notifications/mentions"===e)return async function(t,e,n){for(const s of n)k(v,t,s.id,s),k(S,t,s.account.id,s.account),s.status&&k(_,t,s.status.id,s.status);const o=await U(t),c=[u,i,r,s];await Z(o,c,"readwrite",(t=>{const[s,o,c,r]=t;for(const a of n)Dt(o,r,c,a),s.put(a.id,Y(e,a.id))}))}(t,e,n);if(e.startsWith("status/")){return async function(t,e,n){for(const s of n)lt(s,t);const o=await U(t),c=[f,s,r];await Z(o,c,"readwrite",(t=>{const[s,o,c]=t;s.getAllKeys(nt(e)).onsuccess=t=>{const o=t.target.result,c=(0,dt.DZ)(n.length,(t=>et(e,t))),r=(0,ft.e5)(o,c);for(const e of r)s.delete(e)},n.forEach(((t,n)=>{vt(o,c,t),s.put(t.id,et(e,n))}))}))}(t,e.split("/").slice(-1)[0],n)}return async function(t,e,n){for(const s of n)lt(s,t);const c=await U(t),a=[o,s,r];await Z(c,a,"readwrite",(t=>{const[s,o,c]=t;for(const r of n)vt(o,c,r),s.put(r.id,Y(e,r.id))}))}(t,e,n)}async function xt(t,e){lt(e,t);const n=await U(t);await Z(n,[s,r],"readwrite",(([t,n])=>{vt(t,n,e)}))}function kt(t,e,n){t.get(e).onsuccess=t=>{n(t.target.result)}}function At(t,e,n,s){t.get(n).onsuccess=n=>{const o=n.target.result;s(o),o&&(kt(e,o[h],(t=>{o.account=t})),o[y]&&At(t,e,o[y],(t=>{o.reblog=t})))}}async function Et(t,e,n){for(const s of n)lt(s,t);const o=await U(t),c=[l,s,r];await Z(o,c,"readwrite",(t=>{const[s,o,c]=t,r=st(e);s.getAll(r).onsuccess=t=>{const r=t.target.result;for(let o=n.length;o<r.length;o++)s.delete(st(e));n.forEach(((t,n)=>{vt(o,c,t),s.put(t.id,function(t,e){return t+"\0"+(0,W.Bu)(e,3)}(e,n))}))}}))}async function Kt(t,e){const n=[l,s,r];return Z(await U(t),n,"readonly",((t,n)=>{const[s,o,c]=t,r=st(e);s.getAll(r).onsuccess=t=>{const e=t.target.result,s=new Array(e.length);e.forEach(((t,e)=>{At(o,c,t,(t=>{s[e]=t}))})),n(s)}}))}function Rt(t,e,n,s,o){t.get(s).onsuccess=t=>{const s=t.target.result;o(s),s&&(kt(n,s[h],(t=>{s.account=t})),s[g]&&At(e,n,s[g],(t=>{s.status=t})))}}var zt=n(9109);async function Ft(t,e,n,c){if(n=n||null,c=c||zt.L,"notifications"===e||"notifications/mentions"===e)return async function(t,e,n,o){const c=[u,i,s,r];return Z(await U(t),c,"readonly",((t,s)=>{const[c,r,a,i]=t,u=tt(e,n);c.getAll(u,o).onsuccess=t=>{const e=t.target.result,n=new Array(e.length);e.forEach(((t,e)=>{Rt(r,a,i,t,(t=>{n[e]=t}))})),s(n)}}))}(t,e,n,c);if(e.startsWith("status/")){return async function(t,e){const n=[f,s,r];return Z(await U(t),n,"readonly",((t,n)=>{const[s,o,c]=t,r=nt(e);s.getAll(r).onsuccess=t=>{const s=t.target.result;if(s.length){const t=new Array(s.length);n(t),s.forEach(((e,n)=>{At(o,c,e,(e=>{t[n]=e}))}))}else At(o,c,e,(t=>{n([t])}))}}))}(t,e.split("/").slice(-1)[0])}return async function(t,e,n,c){const a=[o,s,r];return Z(await U(t),a,"readonly",((t,s)=>{const[o,r,a]=t;o.getAll(tt(e,n),c).onsuccess=t=>{const e=t.target.result,n=new Array(e.length);e.forEach(((t,e)=>{At(r,a,t,(t=>{n[e]=t}))})),s(n)}}))}(t,e,n,c)}async function jt(t,e){if(E(_,t,e))return A(_,t,e);const n=await U(t),o=[s,r],c=await Z(n,o,"readonly",((t,n)=>{const[s,o]=t;At(s,o,e,n)}));return k(_,t,e,c),c}async function Pt(t,e){if(E(v,t,e))return A(v,t,e);const n=await U(t),o=[i,s,r],c=await Z(n,o,"readonly",((t,n)=>{const[s,o,c]=t;Rt(s,o,c,e,n)}));return k(v,t,e,c),c}async function Lt(t,e,n){const o=await U(t);if(E(_,t,e)){const s=A(_,t,e);n(s),lt(s,t)}return Z(o,s,"readwrite",(t=>{t.get(e).onsuccess=e=>{const s=e.target.result;n(s),It(t,s)}}))}async function Nt(t,e,n){return Lt(t,e,(t=>{const e=(n?1:0)-(t.favourited?1:0);t.favourited=n,t.favourites_count=(t.favourites_count||0)+e}))}async function Mt(t,e,n){return Lt(t,e,(t=>{const e=(n?1:0)-(t.reblogged?1:0);t.reblogged=n,t.reblogs_count=(t.reblogs_count||0)+e}))}async function Ot(t,e,n){return Lt(t,e,(t=>{t.pinned=n}))}async function Tt(t,e,n){return Lt(t,e,(t=>{t.muted=n}))}async function Wt(t,e,n){return Lt(t,e,(t=>{t.bookmarked=n}))}const $t=["content","spoiler_text","sensitive","language","media_ids","poll"];async function qt(t,e){const n=X(e);return Lt(t,e.id,(t=>{for(const e of $t)e in n?t[e]=n[e]:delete t[e]}))}async function Vt(t,e,n){for(const s of e)K(_,t,s);for(const s of n)K(v,t,s);const c=await U(t),r=[s,o,i,u,l,f];await Z(c,r,"readwrite",(t=>{const[s,o,c,r,a,i]=t;function u(t){s.delete(t),yt(a,a.index("statusId"),IDBKeyRange.only(t)),yt(o,o.index("statusId"),IDBKeyRange.only(t)),yt(i,i.index("statusId"),IDBKeyRange.only(t)),yt(i,i,nt(t))}function l(t){c.delete(t),yt(r,r.index("notificationId"),IDBKeyRange.only(t))}for(const n of e)u(n);for(const e of n)l(e)}))}async function Ht(t,e){if(E(C,t,e))return A(C,t,e);const n=await U(t),s=await Z(n,c,"readonly",((t,n)=>{t.get(e).onsuccess=t=>{n(t.target.result)}}));return k(C,t,e,s),s}async function Ut(t,e,n){k(C,t,e,n);return Z(await U(t),c,"readwrite",(t=>{t.put(n,e)}))}async function Zt(t){return Ht(t,"verifyCredentials")}async function Gt(t,e){return Ut(t,"verifyCredentials",e)}async function Jt(t){return Ht(t,"instance")}async function Qt(t,e){return Ut(t,"instance",e)}async function Xt(t){return Ht(t,"lists")}async function Yt(t,e){return Ut(t,"lists",e)}async function te(t){return Ht(t,"customEmoji")}async function ee(t,e){return Ut(t,"customEmoji",e)}async function ne(t){return Ht(t,"followRequestCount")}async function se(t,e){return Ut(t,"followRequestCount",e)}async function oe(t){return Ht(t,"filters")}async function ce(t,e){return Ut(t,"filters",e)}async function re(t,e){return J(a,I,t,e)}async function ae(t,e){return Q(a,I,t,X(e))}const ie="web-share-data";function ue(){return N(ie)}function le(t){return L(ie,t)}function fe(){return P(ie)}function de(){return O()}function he(t){return L("theme",t)}function ge(){return P("theme")}function ye(t){return L("iconColors",t)}function we(){return P("iconColors")}N("theme-color");var me=n(5524);const be="media-cache-",pe="-cache-",_e=6048e5;let Se=_e;function Ie(t){const e=(t=t.substring(be.length)).indexOf(pe);return[t.substring(0,e),t.substring(e+pe.length)]}async function Ce(){return(await M()).filter((t=>t.startsWith(be))).sort()}async function ve(t){const e=await Ce();for(const n of e){if(t===Ie(n)[1])return P(n)}}async function De(t,e){const n=await Ce();if(n.map(Ie).map((t=>t[1])).includes(t))return;const{maxStatusMediaAttachments:s}=me.h.get();for(;n.length>=s;)await N(n.shift());for(const c of n){const t=Ie(c)[0];Date.now()-Date.parse(t)>=Se&&await N(c)}const o=function(t,e){return`${be}${t}${pe}${e}`}((new Date).toISOString(),t);await L(o,e)}async function Be(t){const e=await Ce();for(const n of e){Ie(n)[1]===t&&await N(n)}}async function xe(){return(await Ce()).map(Ie).map((t=>t[1]))}function ke(t){Se=t}},370:(t,e,n)=>{n.d(e,{P:()=>o,f:()=>s});const s=432e6,o=3e5},9109:(t,e,n)=>{n.d(e,{L:()=>s,q:()=>o});const s=20,o={home:{name:"home",label:"Home"},local:{name:"local",label:"Local"},bubble:{name:"bubble",label:"Bubble"},federated:{name:"federated",label:"Federated"}}},4698:(t,e,n)=>{n.d(e,{c:()=>c});var s=n(9749);const{EventEmitter:o}=s;class c extends o{constructor(t={}){if(super(),!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");this.maxSize=t.maxSize,this.cache=new Map,this.oldCache=new Map,this._size=0}_set(t,e){if(this.cache.set(t,e),this._size++,this._size>=this.maxSize){if(this._size=0,this.listenerCount("evict"))for(const t of this.oldCache.keys())this.cache.has(t)||this.emit("evict",this.oldCache.get(t),t);this.oldCache=this.cache,this.cache=new Map}}get(t){if(this.cache.has(t))return this.cache.get(t);if(this.oldCache.has(t)){const e=this.oldCache.get(t);return this.oldCache.delete(t),this._set(t,e),e}}set(t,e){return this.cache.has(t)?this.cache.set(t,e):this._set(t,e),this}has(t){return this.cache.has(t)||this.oldCache.has(t)}delete(t){const e=this.cache.delete(t);return e&&this._size--,this.oldCache.delete(t)||e}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}getAllKeys(){const t=new Set;for(const e of this.cache.keys())t.add(e);for(const e of this.oldCache.keys())t.add(e);return t}}},3274:(t,e,n)=>{n.d(e,{Bu:()=>a,gV:()=>l,hC:()=>u});var s=n(85);const o=48,c=122,r=30;function a(t,e){return(0,s.Sk)(t,e,"0")}function i(t){return a(t,r)}function u(t){const e=i(t);let n="";for(let s=0;s<e.length;s++){const t=e.charCodeAt(s),r=o+c-t;n+=String.fromCharCode(r)}return n}function l(t,e){const n=i(t.id),s=i(e.id);return n<s?-1:n===s?0:1}}}]);
//# sourceMappingURL=7134.a7c1d00a151922ae7f60.7134.js.map